<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="A walk through of a simple approach to jointly estimating the effective reproduction number over time and the delay from a positive test to this test being reported.">
<title>Estimating the effective reproduction number in real-time for a single timeseries with reporting delays • epinowcast</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Estimating the effective reproduction number in real-time for a single timeseries with reporting delays">
<meta property="og:description" content="A walk through of a simple approach to jointly estimating the effective reproduction number over time and the delay from a positive test to this test being reported.">
<meta property="og:image" content="figures/single-timeseries-rt-estimation-plot-germany-rt-1.png">
<meta property="og:image:alt" content="An R package for flexible hierarchical nowcasting">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:creator" content="@seabbs">
<meta name="twitter:site" content="@seabbs">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">epinowcast</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">0.2.3.2000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/epinowcast.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <h6 class="dropdown-header" data-toc-skip>Model details</h6>
    <a class="dropdown-item" href="../articles/model.html">Model definition and implementation</a>
    <a class="dropdown-item" href="../articles/distributions.html">Discretised distributions</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Case studies</h6>
    <a class="dropdown-item" href="../articles/germany-age-stratified-nowcasting.html">Hierarchical nowcasting of age stratified COVID-19 hospitalisations in Germany</a>
    <a class="dropdown-item" href="../articles/single-timeseries-rt-estimation.html">Estimating the effective reproduction number in real-time for a single timeseries with reporting delays</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/epinowcast/epinowcast/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">


<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Estimating the effective reproduction number in real-time for a single timeseries with reporting delays</h1>
                        <h4 data-toc-skip class="author">Sam Abbott</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/epinowcast/epinowcast/blob/HEAD/vignettes/single-timeseries-rt-estimation.Rmd" class="external-link"><code>vignettes/single-timeseries-rt-estimation.Rmd</code></a></small>
      <div class="d-none name"><code>single-timeseries-rt-estimation.Rmd</code></div>
    </div>

    
    
<div class="alert alert-warning">
<p>This vignette is partly based on this <a href="https://github.com/epiforecasts/nowcasting.example" class="external-link">nowcasting example</a> by Sebastian Funk and Sam Abbott.</p>
</div>
<p>In this case study we walk through a simple approach to jointly estimating the effective reproduction number over time and the delay from a positive test to this test being reported. For more on the <code>epinowcast</code> package see the <a href="https://package.epinowcast.org/">documentation</a>.</p>
<div class="section level2 unnumbered alert alert-primary">
<h2 id="use-case">Use case<a class="anchor" aria-label="anchor" href="#use-case"></a>
</h2>
<p>An epidemic is in progress. We want to know what the <strong>effective reproduction number is at the current time</strong>. This is the average number of secondary infections caused by a single infected individual at a given point in time and is a measure of the transmissibility of the infection in the population at that time.</p>
<p>Unfortunately, we can’t directly observe infections and the data we do observe suffers from reporting delays.</p>
</div>
<div class="alert alert-secondary">
<div class="section level3 unnumbered">
<h3 id="what-we-have">What we have<a class="anchor" aria-label="anchor" href="#what-we-have"></a>
</h3>
<ol style="list-style-type: decimal">
<li>A linelist of cases with a date of interest (for example test positive date) and a date of report (for example date of hospitalisation report);</li>
<li>An estimate of the distribution of times from infection to positive test;</li>
<li>An estimate of the generation time distribution, which is the distribution of the time intervals between the infection of a primary case and the infection of secondary cases caused by the primary case.</li>
<li>An estimate of the ascertainment rate, which is the proportion of infections that are reported as hospitalisations.</li>
</ol>
</div>
<div class="section level3 unnumbered">
<h3 id="what-do-we-do">What do we do<a class="anchor" aria-label="anchor" href="#what-do-we-do"></a>
</h3>
<ol style="list-style-type: decimal">
<li>Visualise and contextualise the data this case study uses (COVID-19 hospitalisations in Germany);</li>
<li>Specify a joint model of the effective reproduction number, the delay from infection to hospitalisation and the delay from hospitalisation to report;</li>
<li>Fit this model to both the data that would have been available in real-time, and retrospectively;</li>
<li>Visualise the nowcast from the real-time data in comparison to the data that was ultimately observed;</li>
<li>Compare real-time and retrospective reproduction number estimates and delay distribution estimates;</li>
<li>Outline the limitations and strengths of this approach and highlight areas where it can be extended.</li>
</ol>
</div>
</div>
<div class="alert alert-warning">
<p><code>epinowcast</code> is still in development and so the following case study has pain points and limitations that we are working on improving. If you have any suggestions or feedback please get in touch via the <a href="https://github.com/epinowcast/epinowcast/issues" class="external-link">issues page</a>. We also welcome contributions via pull requests (see our <a href="https://github.com/epinowcast/epinowcast/blob/main/CONTRIBUTING.md" class="external-link">contributing guidelines</a>.</p>
</div>
<div class="section level2">
<h2 id="getting-setup">Getting setup<a class="anchor" aria-label="anchor" href="#getting-setup"></a>
</h2>
<p>See the <a href="https://epiforecasts.io/epinowcast/" class="external-link">package documentation</a> for guidance on installing the package and getting setup with <code>cmdstanr</code> (the backend used here for fitting models).</p>
<p>As well as the <code>epinowcast</code> package we will use the following packages in this vignette.</p>
<details class="chunk-details" open><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://package.epinowcast.org">epinowcast</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://purrr.tidyverse.org/" class="external-link">purrr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
</details><div class="alert alert-warning">
<ul>
<li>Here we make use of <code>data.table</code> for simple data transformations but tools from the tidyverse or base R tools could just as easily be used;</li>
<li>We also use <code>purrr</code> to make use of the <code><a href="https://purrr.tidyverse.org/reference/partial.html" class="external-link">partial()</a></code> function which allows us to partially specify a function for later reuse. This is useful for specifying the model as we can specify the parts of the model that are common to all models and then specify the parts that are specific to each model when we call the updated function;</li>
<li>Finally, we use <code>ggplot2</code> for plotting.</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="introducing-the-data-covid-19-hospitalisations-in-germany">Introducing the data: COVID-19 hospitalisations in Germany<a class="anchor" aria-label="anchor" href="#introducing-the-data-covid-19-hospitalisations-in-germany"></a>
</h2>
<div class="section level3">
<h3 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h3>
<p>In this case study, we use data sourced from the <a href="https://github.com/KITmetricslab/hospitalization-nowcast-hub/wiki/Truth-data#role-an-definition-of-the-seven-day-hospitalization-incidence" class="external-link">Robert Koch Institute via the Germany Nowcasting hub</a>. The data represent hospitalisation counts by date of positive test and date of test report in Germany. These data have been used extensively for nowcasting and forecasting COVID-19 hospitalisations in Germany and are described in detail in <a href="https://doi.org/10.1101/2023.04.17.23288668" class="external-link">Wolffram et al. (2023)</a>. We use these data as they are a good example of the type of data that are available in many settings. We first summarise the data,</p>
<details class="chunk-details" open><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">germany_covid19_hosp</span><span class="op">)</span></span>
<span><span class="co">#&gt;  reference_date          location      age_group         confirm       </span></span>
<span><span class="co">#&gt;  Min.   :2021-04-06   DE     : 90405   00-04:219555   Min.   :   0.00  </span></span>
<span><span class="co">#&gt;  1st Qu.:2021-05-15   DE-BB  : 90405   00+  :219555   1st Qu.:   0.00  </span></span>
<span><span class="co">#&gt;  Median :2021-06-23   DE-BE  : 90405   05-14:219555   Median :   1.00  </span></span>
<span><span class="co">#&gt;  Mean   :2021-06-25   DE-BW  : 90405   15-34:219555   Mean   :  11.44  </span></span>
<span><span class="co">#&gt;  3rd Qu.:2021-08-02   DE-BY  : 90405   35-59:219555   3rd Qu.:   6.00  </span></span>
<span><span class="co">#&gt;  Max.   :2021-10-20   DE-HB  : 90405   60-79:219555   Max.   :1552.00  </span></span>
<span><span class="co">#&gt;                       (Other):994455   80+  :219555                    </span></span>
<span><span class="co">#&gt;   report_date        </span></span>
<span><span class="co">#&gt;  Min.   :2021-04-06  </span></span>
<span><span class="co">#&gt;  1st Qu.:2021-06-24  </span></span>
<span><span class="co">#&gt;  Median :2021-08-03  </span></span>
<span><span class="co">#&gt;  Mean   :2021-07-31  </span></span>
<span><span class="co">#&gt;  3rd Qu.:2021-09-11  </span></span>
<span><span class="co">#&gt;  Max.   :2021-10-20  </span></span>
<span><span class="co">#&gt; </span></span></code></pre></div>
</details><p>In this case study we only consider national level data without stratification by age group. We can filter these data using <code>data.table</code> as follows,</p>
<details class="chunk-details" open><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">germany_hosp</span> <span class="op">&lt;-</span> <span class="va">germany_covid19_hosp</span><span class="op">[</span><span class="va">location</span> <span class="op">==</span> <span class="st">"DE"</span><span class="op">]</span><span class="op">[</span><span class="va">age_group</span> <span class="op">==</span> <span class="st">"00+"</span><span class="op">]</span></span>
<span><span class="va">germany_hosp</span> <span class="op">&lt;-</span> <span class="va">germany_hosp</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span><span class="va">reference_date</span>, <span class="va">report_date</span>, <span class="va">confirm</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">germany_hosp</span></span>
<span><span class="co">#&gt;        reference_date report_date confirm</span></span>
<span><span class="co">#&gt;     1:     2021-04-06  2021-04-06     149</span></span>
<span><span class="co">#&gt;     2:     2021-04-07  2021-04-07     312</span></span>
<span><span class="co">#&gt;     3:     2021-04-08  2021-04-08     424</span></span>
<span><span class="co">#&gt;     4:     2021-04-09  2021-04-09     288</span></span>
<span><span class="co">#&gt;     5:     2021-04-10  2021-04-10     273</span></span>
<span><span class="co">#&gt;    ---                                   </span></span>
<span><span class="co">#&gt; 12911:     2021-07-27  2021-10-16      81</span></span>
<span><span class="co">#&gt; 12912:     2021-07-28  2021-10-17     159</span></span>
<span><span class="co">#&gt; 12913:     2021-07-29  2021-10-18     145</span></span>
<span><span class="co">#&gt; 12914:     2021-07-30  2021-10-19     117</span></span>
<span><span class="co">#&gt; 12915:     2021-07-31  2021-10-20     132</span></span></code></pre></div>
</details>
</div>
<div class="section level3">
<h3 id="data-transformations">Data transformations<a class="anchor" aria-label="anchor" href="#data-transformations"></a>
</h3>
<p>These data are already in a format that can be used with <code>epinowcast</code>, as it contains</p>
<ul>
<li>a reference date (column <code>reference_date</code>): the date of the observation, in this example the date of a positive test</li>
<li>a report date (column <code>report_date</code>): the date of report for a given set of observations by reference date</li>
<li>a count (column <code>confirm</code>): the total number of hospitalisations by reference date and report date. Note that this is cumulative by report date.</li>
</ul>
<p>The package also provides a range of tools to convert data from line list, incidence, or other common formats into the required format (see <a href="https://package.epinowcast.org/dev/reference/index.html#data-converters">Data converters</a>). For example we could convert the data to a individual case linelist,</p>
<details class="chunk-details" open><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">germany_covid19_hosp_linelist</span> <span class="op">&lt;-</span> <span class="va">germany_covid19_hosp</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/enw_add_incidence.html">enw_add_incidence</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/enw_incidence_to_linelist.html">enw_incidence_to_linelist</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">germany_covid19_hosp_linelist</span></span>
<span><span class="co">#&gt;                 id reference_date location age_group report_date delay</span></span>
<span><span class="co">#&gt;        1:        1     2021-04-06       DE       00+  2021-04-06     0</span></span>
<span><span class="co">#&gt;        2:        2     2021-04-06       DE       00+  2021-04-06     0</span></span>
<span><span class="co">#&gt;        3:        3     2021-04-06       DE       00+  2021-04-06     0</span></span>
<span><span class="co">#&gt;        4:        4     2021-04-06       DE       00+  2021-04-06     0</span></span>
<span><span class="co">#&gt;        5:        5     2021-04-06       DE       00+  2021-04-06     0</span></span>
<span><span class="co">#&gt;       ---                                                             </span></span>
<span><span class="co">#&gt; 11486202: 11486202     2021-10-20    DE-TH     15-34  2021-10-20   115</span></span>
<span><span class="co">#&gt; 11486203: 11486203     2021-10-20    DE-TH     60-79  2021-10-20   117</span></span>
<span><span class="co">#&gt; 11486204: 11486204     2021-10-20    DE-TH     60-79  2021-10-20   117</span></span>
<span><span class="co">#&gt; 11486205: 11486205     2021-10-20    DE-TH     60-79  2021-10-20   117</span></span>
<span><span class="co">#&gt; 11486206: 11486206     2021-10-20    DE-TH     60-79  2021-10-20   117</span></span></code></pre></div>
</details><p>This linelist could then be itself converted into the format <code>epinowcast</code> requires using the <code><a href="../reference/enw_linelist_to_incidence.html">enw_linelist_to_incidence()</a></code> function,</p>
<details class="chunk-details" open><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">incidence_from_linelist</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/enw_linelist_to_incidence.html">enw_linelist_to_incidence</a></span><span class="op">(</span></span>
<span>  <span class="va">germany_covid19_hosp_linelist</span>,</span>
<span>  reference_date <span class="op">=</span> <span class="st">"reference_date"</span>,</span>
<span>  report_date <span class="op">=</span> <span class="st">"report_date"</span>,</span>
<span>  by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age_group"</span>, <span class="st">"location"</span><span class="op">)</span>,</span>
<span>  max_delay <span class="op">=</span> <span class="fl">30</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">incidence_from_linelist</span></span>
<span><span class="co">#&gt;          age_group location report_date reference_date new_confirm confirm</span></span>
<span><span class="co">#&gt;       1:     00-04    DE-BY  2021-04-06           &lt;NA&gt;           0       0</span></span>
<span><span class="co">#&gt;       2:     00-04    DE-BY  2021-04-07           &lt;NA&gt;           0       0</span></span>
<span><span class="co">#&gt;       3:     00-04    DE-BY  2021-04-08           &lt;NA&gt;           0       0</span></span>
<span><span class="co">#&gt;       4:     00-04    DE-BY  2021-04-09           &lt;NA&gt;           0       0</span></span>
<span><span class="co">#&gt;       5:     00-04    DE-BY  2021-04-10           &lt;NA&gt;           0       0</span></span>
<span><span class="co">#&gt;      ---                                                                  </span></span>
<span><span class="co">#&gt; 2049593:       80+    DE-TH  2021-10-19     2021-10-18           0       0</span></span>
<span><span class="co">#&gt; 2049594:       80+    DE-TH  2021-10-20     2021-10-18           0       0</span></span>
<span><span class="co">#&gt; 2049595:       80+    DE-TH  2021-10-19     2021-10-19           1       1</span></span>
<span><span class="co">#&gt; 2049596:       80+    DE-TH  2021-10-20     2021-10-19           0       1</span></span>
<span><span class="co">#&gt; 2049597:       80+    DE-TH  2021-10-20     2021-10-20           0       0</span></span>
<span><span class="co">#&gt;          delay</span></span>
<span><span class="co">#&gt;       1:     0</span></span>
<span><span class="co">#&gt;       2:     1</span></span>
<span><span class="co">#&gt;       3:     2</span></span>
<span><span class="co">#&gt;       4:     3</span></span>
<span><span class="co">#&gt;       5:     4</span></span>
<span><span class="co">#&gt;      ---      </span></span>
<span><span class="co">#&gt; 2049593:     1</span></span>
<span><span class="co">#&gt; 2049594:     2</span></span>
<span><span class="co">#&gt; 2049595:     0</span></span>
<span><span class="co">#&gt; 2049596:     1</span></span>
<span><span class="co">#&gt; 2049597:     0</span></span></code></pre></div>
</details><div class="alert alert-warning">
<p>Here we have specified the <code>reference_date</code> and <code>report_date</code> columns, the <code>by</code> columns (which are used to group the data), and the <code>max_delay</code> which is the maximum delay between the reference date and the report date (note that the observed delay is longer than our specified delay and so is used instead). The <code><a href="../reference/enw_linelist_to_incidence.html">enw_linelist_to_incidence()</a></code> function will then calculate the incidence by reference date and report date for each group.</p>
</div>
</div>
<div class="section level3">
<h3 id="filtering-the-data">Filtering the data<a class="anchor" aria-label="anchor" href="#filtering-the-data"></a>
</h3>
<p>For this case study we will only consider data from the 1st of March 2020 onwards. As a first step, we filter the data to only include observations from the 1st of May 2021 until the 1st of August 2021. We do this using the <code><a href="../reference/enw_filter_report_dates.html">enw_filter_report_dates()</a></code> and <code><a href="../reference/enw_filter_reference_dates.html">enw_filter_reference_dates()</a></code> functions,</p>
<details class="chunk-details" open><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">complete_germany_hosp</span> <span class="op">&lt;-</span> <span class="va">germany_hosp</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/enw_filter_report_dates.html">enw_filter_report_dates</a></span><span class="op">(</span>latest_date <span class="op">=</span> <span class="st">"2021-08-01"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/enw_filter_reference_dates.html">enw_filter_reference_dates</a></span><span class="op">(</span>earliest_date <span class="op">=</span> <span class="st">"2021-05-01"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/enw_complete_dates.html">enw_complete_dates</a></span><span class="op">(</span>missing_reference <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/enw_add_incidence.html">enw_add_incidence</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</details><p>Here we have also used <code><a href="../reference/enw_complete_dates.html">enw_complete_dates()</a></code> to make sure that we have complete data for all dates between the earliest and latest dates. We have also used <code><a href="../reference/enw_add_incidence.html">enw_add_incidence()</a></code> to add the incidence column to the data.</p>
<p>Next we split the data into two parts, the data that was available at the time and that will be used to fit the model (<code>rt_nat_germany</code>) and the data that was available retrospectively about the same time period will be used to evaluate the model (<code>retro_nat_germany</code>). We again do this using the <code><a href="../reference/enw_filter_report_dates.html">enw_filter_report_dates()</a></code> and <code><a href="../reference/enw_filter_reference_dates.html">enw_filter_reference_dates()</a></code> functions as follows:</p>
<ul>
<li>Create the real-time dataset (<code>rt_nat_germany</code>) by filtering the data to only include reported observations from the 1st of May 2021 until the 1st of July 2021;</li>
</ul>
<details class="chunk-details" open><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rt_germany</span> <span class="op">&lt;-</span> <span class="va">complete_germany_hosp</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/enw_filter_report_dates.html">enw_filter_report_dates</a></span><span class="op">(</span>latest_date <span class="op">=</span> <span class="st">"2021-07-01"</span><span class="op">)</span></span>
<span><span class="va">rt_germany</span></span>
<span><span class="co">#&gt;       report_date reference_date confirm new_confirm delay</span></span>
<span><span class="co">#&gt;    1:  2021-05-01     2021-05-01     234         234     0</span></span>
<span><span class="co">#&gt;    2:  2021-05-02     2021-05-01     352         118     1</span></span>
<span><span class="co">#&gt;    3:  2021-05-03     2021-05-01     391          39     2</span></span>
<span><span class="co">#&gt;    4:  2021-05-04     2021-05-01     464          73     3</span></span>
<span><span class="co">#&gt;    5:  2021-05-05     2021-05-01     507          43     4</span></span>
<span><span class="co">#&gt;   ---                                                     </span></span>
<span><span class="co">#&gt; 1949:  2021-06-30     2021-06-29      31          11     1</span></span>
<span><span class="co">#&gt; 1950:  2021-07-01     2021-06-29      35           4     2</span></span>
<span><span class="co">#&gt; 1951:  2021-06-30     2021-06-30      20          20     0</span></span>
<span><span class="co">#&gt; 1952:  2021-07-01     2021-06-30      37          17     1</span></span>
<span><span class="co">#&gt; 1953:  2021-07-01     2021-07-01      20          20     0</span></span></code></pre></div>
</details><ul>
<li>Create the retrospective dataset (<code>retro_germany</code>) by filtering the data to only include observations with reference dates (i.e. they may have been reported anytime up to the 1st of August 2021) from the 1st of May 2021 until the 1st of July 2021;</li>
</ul>
<details class="chunk-details" open><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">retro_germany</span> <span class="op">&lt;-</span> <span class="va">complete_germany_hosp</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/enw_filter_reference_dates.html">enw_filter_reference_dates</a></span><span class="op">(</span>latest_date <span class="op">=</span> <span class="st">"2021-07-01"</span><span class="op">)</span></span>
<span><span class="va">retro_germany</span></span>
<span><span class="co">#&gt;       report_date reference_date confirm new_confirm delay</span></span>
<span><span class="co">#&gt;    1:  2021-05-01     2021-05-01     234         234     0</span></span>
<span><span class="co">#&gt;    2:  2021-05-02     2021-05-01     352         118     1</span></span>
<span><span class="co">#&gt;    3:  2021-05-03     2021-05-01     391          39     2</span></span>
<span><span class="co">#&gt;    4:  2021-05-04     2021-05-01     464          73     3</span></span>
<span><span class="co">#&gt;    5:  2021-05-05     2021-05-01     507          43     4</span></span>
<span><span class="co">#&gt;   ---                                                     </span></span>
<span><span class="co">#&gt; 3871:  2021-07-28     2021-07-01      57           0    27</span></span>
<span><span class="co">#&gt; 3872:  2021-07-29     2021-07-01      57           0    28</span></span>
<span><span class="co">#&gt; 3873:  2021-07-30     2021-07-01      57           0    29</span></span>
<span><span class="co">#&gt; 3874:  2021-07-31     2021-07-01      57           0    30</span></span>
<span><span class="co">#&gt; 3875:  2021-08-01     2021-07-01      57           0    31</span></span></code></pre></div>
</details><p>Finally we can create a dataset that contains the latest data available for each reference date. We do this using the <code><a href="../reference/enw_latest_data.html">enw_latest_data()</a></code> function,</p>
<details class="chunk-details" open><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">latest_germany_hosp</span> <span class="op">&lt;-</span> <span class="va">retro_germany</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/enw_latest_data.html">enw_latest_data</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">latest_germany_hosp</span>, n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt;     reference_date report_date confirm new_confirm delay</span></span>
<span><span class="co">#&gt;  1:     2021-05-01  2021-08-01    1007           0    92</span></span>
<span><span class="co">#&gt;  2:     2021-05-02  2021-08-01     781           0    91</span></span>
<span><span class="co">#&gt;  3:     2021-05-03  2021-08-01     467           0    90</span></span>
<span><span class="co">#&gt;  4:     2021-05-04  2021-08-01     823           0    89</span></span>
<span><span class="co">#&gt;  5:     2021-05-05  2021-08-01    1028           0    88</span></span>
<span><span class="co">#&gt;  6:     2021-05-06  2021-08-01    1016           0    87</span></span>
<span><span class="co">#&gt;  7:     2021-05-07  2021-08-01     892           0    86</span></span>
<span><span class="co">#&gt;  8:     2021-05-08  2021-08-01     822           0    85</span></span>
<span><span class="co">#&gt;  9:     2021-05-09  2021-08-01     561           0    84</span></span>
<span><span class="co">#&gt; 10:     2021-05-10  2021-08-01     364           0    83</span></span></code></pre></div>
</details>
</div>
<div class="section level3">
<h3 id="visualising-the-data">Visualising the data<a class="anchor" aria-label="anchor" href="#visualising-the-data"></a>
</h3>
<p>Before we define, or fit, a model we should visualise the data to get an idea of the trends in the data and its reporting structure. There is currently no function in <code>epinowcast</code> to visualise the data, but we can use the <code>ggplot2</code> package to do this manually as follows,</p>
<details class="chunk-details"><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gh_vis_cohorts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/copy.html" class="external-link">copy</a></span><span class="op">(</span><span class="va">retro_germany</span><span class="op">)</span><span class="op">[</span></span>
<span>  ,</span>
<span>  <span class="va">report_date</span> <span class="op">:=</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/fcase.html" class="external-link">fcase</a></span><span class="op">(</span></span>
<span>    <span class="va">report_date</span> <span class="op">&lt;=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2021-05-15"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2021-05-15"</span><span class="op">)</span>,</span>
<span>    <span class="va">report_date</span> <span class="op">&lt;=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2021-06-01"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2021-06-01"</span><span class="op">)</span>,</span>
<span>    <span class="va">report_date</span> <span class="op">&lt;=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2021-06-15"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2021-06-15"</span><span class="op">)</span>,</span>
<span>    <span class="va">report_date</span> <span class="op">&lt;=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2021-07-01"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2021-07-01"</span><span class="op">)</span>,</span>
<span>    <span class="va">report_date</span> <span class="op">&lt;=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2021-07-15"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2021-07-15"</span><span class="op">)</span>,</span>
<span>    <span class="va">report_date</span> <span class="op">&lt;=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2021-08-01"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2021-08-01"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span>levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>      <span class="st">"2021-05-15"</span>, <span class="st">"2021-06-01"</span>, <span class="st">"2021-06-15"</span>, <span class="st">"2021-07-01"</span>,</span>
<span>      <span class="st">"2021-07-15"</span>, <span class="st">"2021-08-01"</span></span>
<span>    <span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">]</span></span>
<span></span>
<span><span class="va">gh_vis_cohorts_by_reference</span> <span class="op">&lt;-</span> <span class="va">gh_vis_cohorts</span><span class="op">[</span>,</span>
<span>  <span class="fu">.</span><span class="op">(</span>confirm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">new_confirm</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  by <span class="op">=</span> <span class="fu">.</span><span class="op">(</span><span class="va">reference_date</span><span class="op">)</span></span>
<span><span class="op">]</span></span>
<span></span>
<span><span class="va">gh_vis_cohorts_by_ref_rep</span> <span class="op">&lt;-</span> <span class="va">gh_vis_cohorts</span><span class="op">[</span>,</span>
<span>  <span class="fu">.</span><span class="op">(</span>confirm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">new_confirm</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  by <span class="op">=</span> <span class="fu">.</span><span class="op">(</span><span class="va">reference_date</span>, <span class="va">report_date</span><span class="op">)</span></span>
<span><span class="op">]</span></span>
<span></span>
<span><span class="va">gh_vis_cohorts_by_ref_rep</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">reference_date</span>, y <span class="op">=</span> <span class="va">confirm</span>, fill <span class="op">=</span> <span class="va">report_date</span>, group <span class="op">=</span> <span class="va">report_date</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_col</a></span><span class="op">(</span>position <span class="op">=</span> <span class="st">"stack"</span>, alpha <span class="op">=</span> <span class="fl">1</span>, col <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="va">report_date</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    linetype <span class="op">=</span> <span class="fl">2</span>, alpha <span class="op">=</span> <span class="fl">0.9</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>labels <span class="op">=</span> \<span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">(</span><span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/comma.html" class="external-link">comma</a></span><span class="op">(</span><span class="va">x</span>, accuracy <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_fill_brewer</a></span><span class="op">(</span></span>
<span>    palette <span class="op">=</span> <span class="st">"Blues"</span>, aesthetics <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"color"</span>, <span class="st">"fill"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Date of positive test"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Hospitalised cases by date of positive test"</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"Report date"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>reverse <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span></code></pre></div>
</details><div class="figure">
<img src="figures/single-timeseries-rt-estimation-unnamed-chunk-10-1.png" alt=""><p class="caption">Hospitalisations in Germany by date of positive test and date of report</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="model">Model<a class="anchor" aria-label="anchor" href="#model"></a>
</h2>
<p>The <code>epinowcast</code> package provides a flexible framework for modelling the incidence of infections and subsequent measures such as hospitalisations that are themselves reported with some delay. The framework is based on a generative model that describes the hypothesised process by which the data are generated. The generative model is then used to define a likelihood function that describes the probability of observing the data given the model parameters. The likelihood function is then combined with prior information used to fit the model parameters to the data. In the following sections we describe the generative model for the incidence of infections and hospitalisations. If you would like to know more about the general framework see the <a href="https://package.epinowcast.org/articles/model.html">model vignette</a>.</p>
<div class="section level3">
<h3 id="expected-hospitalisations">Expected hospitalisations<a class="anchor" aria-label="anchor" href="#expected-hospitalisations"></a>
</h3>
<p>The first part of the generative process we consider is the expected number of hospitalisations by date positive test. This is the number of hospitalisations that we would expect to observe if we had perfect reporting of hospitalisations and there was no unmodelled variance. This part of the model is also decomposed into three parts: the expected number of infections, the delay from infection to positive test, and the probability of hospitalisation given an infection. These three parts are combined to give the expected number of hospitalisations by date positive test. We describe each of these parts in turn.</p>
<div class="section level4">
<h4 id="expected-infections">Expected infections<a class="anchor" aria-label="anchor" href="#expected-infections"></a>
</h4>
<p>We model expected infections as a function of the effective (instantaneous) reproduction number and previous infections weighted by the generation time using the renewal equation<span class="citation"><sup>[<a href="#ref-Fraser2007" role="doc-biblioref">1</a>,<a href="#ref-Cori2013" role="doc-biblioref">2</a>]</sup></span>. This corresponds to the commonly used Susceptible-Exposed-Infected-Recovered (SEIR) model when the appropriate generation time is specified<span class="citation"><sup>[<a href="#ref-champredon" role="doc-biblioref">3</a>]</sup></span>.</p>
<div class="section level5">
<h5 id="instantaneous-reproduction-number">Instantaneous reproduction number<a class="anchor" aria-label="anchor" href="#instantaneous-reproduction-number"></a>
</h5>
<p>We model the instantaneous reproduction number (<span class="math inline">\(R_t\)</span>) on the log scale as a weekly random walk as follows</p>
<p><span class="math display">\[\begin{align}
  \text{log} (R_{t}) &amp;= r_0 + \sum_{i = 0}^{t \% 7} \epsilon_i \\
  \epsilon_i &amp;\sim \text{Normal}\left(0, \sigma_{\epsilon} \right) \\
  \sigma_{\epsilon} &amp;\sim \text{HalfNormal}\left(0, 1 \right)
\end{align}\]</span></p>
<p>where <span class="math inline">\(r_0\)</span> is the intercept, and <span class="math inline">\(\sum_{i = 0}^{t \% 7} \epsilon_i\)</span> is a weekly random walk.</p>
<p>We choose this model because it is flexible, can be used to model a range of different scenarios, and is parsimonious. For example, if we set <span class="math inline">\(\sigma_{\epsilon} = 0\)</span> then the model reduces to a constant reproduction number. If we set <span class="math inline">\(\sigma_{\epsilon} &gt; 0\)</span> then the model allows for changes in the reproduction number over time. Other sensible choices for the model include a random walk with a longer time scale (e.g. monthly) or shorter time scale (e.g. daily), a random walk with a drift term, or a random walk with a drift term and a seasonal component.</p>
</div>
<div class="section level5">
<h5 id="latent-infections">Latent infections<a class="anchor" aria-label="anchor" href="#latent-infections"></a>
</h5>
<p>We model the expected number of infections/latent notifications (<span class="math inline">\(\lambda^l\)</span>) using a renewal process<span class="citation"><sup>[<a href="#ref-Fraser2007" role="doc-biblioref">1</a>,<a href="#ref-Cori2013" role="doc-biblioref">2</a>]</sup></span>. This model is a generalisation of the default <code>epinowcast</code> model and implies that current infections/notifications are dependent on past infections/notifications based on a kernel. This kernel is defined by the generation time distribution, the probability distribution of the time between infection and subsequent infectiousness, and the previously defined model for the effective reproduction number. The model is defined as follows,</p>
<p><span class="math display">\[\begin{align}
  \lambda^l_{t} &amp;\sim \text{LogNormal}\left(\mu^{l}, \sigma^{l} \right),\ t \leq P \\
  \lambda^l_{t} &amp;= R_{t} \sum_{p = 1}^{P} g\left(t - p \right)  \lambda^l_{t-p},\ t \gt P  
\end{align}\]</span></p>
<p>We assume the generation time (<span class="math inline">\(g\)</span>) is a gamma distribution with mean 4 days and a standard deviation of 3 days. To initialise the model we assume that the first <span class="math inline">\(P\)</span> latent notifications are log-normally distributed with mean <span class="math inline">\(\mu^{l}_{g,t}\)</span> and standard deviation <span class="math inline">\(\sigma^{l}_{g,t}\)</span>. This is equivalent to assuming that the first <span class="math inline">\(P\)</span> latent notifications are independent and identically distributed. The mean of the log-normal distribution for each group is the log of the latest reported case count for the first reference date for that group scaled by the sum of the latent reporting delay. The standard deviation is assumed to be 1.</p>
</div>
</div>
<div class="section level4">
<h4 id="latent-reporting-delay-and-ascertainment">Latent reporting delay and ascertainment<a class="anchor" aria-label="anchor" href="#latent-reporting-delay-and-ascertainment"></a>
</h4>
<p>In many settings, such as in this case study, there may be additional reporting delays on top of those that are directly observed in the data, and therefore “nowcastable”, a common example is the delay from exposure to symptom onset. For these settings we support modelling “latent” reporting delays as a convolution of the underlying expected counts with the potential for these delays to vary over time and by group. This implementation is similar to that implemented in <code>EpiNow2</code> and <code>epidemia</code> as well as other similar models<span class="citation"><sup>[<a href="#ref-EpiNow2" role="doc-biblioref">4</a>–<a href="#ref-Lison2022" role="doc-biblioref">7</a>]</sup></span>. In addition to this, we support modelling ascertainment through the use of improper probability mass functions (i.e. by not enforcing a sum to 1 constraint) and inferring ascertainment where possible (for example day of the week reporting patterns).</p>
<p>Here we assume an infection to hospitalisation ratio of 2% modified by a random effect for the day of the week to account for within week reporting periodicity. We also assume a lognormal reporting delay with a mean of 5 days and a standard deviation of 2 days, representing the delay from infection to positive test. We assume that the reporting delay is the same for all days of the week. This model is defined as follows,</p>
<p><span class="math display">\[\begin{align}
  \lambda_{t} &amp;= \nu_{t \% 7} \sum_{\tau = 0}^{L - 1} f_{g}\left(t - \tau \right)  \lambda^l_{t - \tau} \\
  \text{log} (\nu_{i}) &amp;\sim \text{Normal}\left(-3.91, \sigma_{\nu} \right) \\
  \sigma_{\nu} &amp;\sim \text{HalfNormal}\left(0, 1 \right) \\
\end{align}\]</span></p>
<p>Where <span class="math inline">\(\nu_{i}\)</span> is a random effect for each day of the week which represents reporting periodicity.</p>
</div>
<div class="section level4">
<h4 id="specifying-the-model-using-epinowcastenw_expectation">Specifying the model using <code>epinowcast::enw_expectation()</code><a class="anchor" aria-label="anchor" href="#specifying-the-model-using-epinowcastenw_expectation"></a>
</h4>
<p>We first need to define the weekly random walk model for the effective reproduction number. We can do this using the formula interface as follows,</p>
<details class="chunk-details" open><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rt_formula</span> <span class="op">&lt;-</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="../reference/rw.html">rw</a></span><span class="op">(</span><span class="va">week</span><span class="op">)</span></span></code></pre></div>
</details><p>Next we define the generation time distribution. As already discussed, we assume a gamma distribution with mean 4 days and a standard deviation of 3 days. These summary parameters first need to be transformed to the shape and scale parameters used for the gamma distribution. We then need to account for daily censoring and finally normalise the probability mass function (PMF) to account for right truncation.</p>
<details class="chunk-details" open><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># first transform mean and sd to shape and scale</span></span>
<span><span class="va">gamma_mean</span> <span class="op">&lt;-</span> <span class="fl">4</span></span>
<span><span class="va">gamma_sd</span> <span class="op">&lt;-</span> <span class="fl">3</span></span>
<span><span class="va">gamma_shape</span> <span class="op">&lt;-</span> <span class="va">gamma_mean</span><span class="op">^</span><span class="fl">2</span> <span class="op">/</span> <span class="va">gamma_sd</span><span class="op">^</span><span class="fl">2</span></span>
<span><span class="va">gamma_scale</span> <span class="op">&lt;-</span> <span class="va">gamma_sd</span><span class="op">^</span><span class="fl">2</span> <span class="op">/</span> <span class="va">gamma_mean</span></span>
<span></span>
<span><span class="co"># then discretise the distribution</span></span>
<span><span class="va">gt_pmf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulate_double_censored_pmf.html">simulate_double_censored_pmf</a></span><span class="op">(</span></span>
<span>  max <span class="op">=</span> <span class="fl">15</span>, shape <span class="op">=</span> <span class="va">gamma_shape</span>, scale <span class="op">=</span> <span class="va">gamma_scale</span>, fun_dist <span class="op">=</span> <span class="va">rgamma</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span><span class="co"># and normalise it to account for right truncation</span></span>
<span>  <span class="op">(</span>\<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">gt_pmf</span><span class="op">)</span></span></code></pre></div>
</details><div class="figure">
<img src="figures/single-timeseries-rt-estimation-unnamed-chunk-12-1.png" alt=""><p class="caption">Probability mass function of the assumed generation interval distribution</p>
</div>
<div class="alert alert-warning">
<p>Here and for other PMFs we set the maximum delay to be 15 days as this gives good coverage of the majority of the distribution and limits the computational burden of fitting the model.</p>
</div>
<p>Now we define the latent reporting delay in a similar way remembering we specified a lognormal distribution with a mean of 5 days and a standard deviation of 2 days. We again also need to account for daily censoring and normalise the PMF to account for right truncation.</p>
<details class="chunk-details" open><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lgn_mean</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span><span class="va">lgn_sd</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span><span class="va">meanlog</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">lgn_mean</span><span class="op">^</span><span class="fl">2</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">lgn_sd</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="va">lgn_mean</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">sdlog</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="va">lgn_sd</span><span class="op">^</span><span class="fl">2</span> <span class="op">/</span> <span class="va">lgn_mean</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># then discretise the distribution</span></span>
<span><span class="va">reporting_pmf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulate_double_censored_pmf.html">simulate_double_censored_pmf</a></span><span class="op">(</span></span>
<span>  max <span class="op">=</span> <span class="fl">15</span>, meanlog <span class="op">=</span> <span class="va">meanlog</span>, sdlog <span class="op">=</span> <span class="va">sdlog</span>, fun_dist <span class="op">=</span> <span class="va">rlnorm</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span><span class="co"># normalise it to account for right truncation</span></span>
<span>  <span class="op">(</span>\<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span><span class="co"># and scale it by the infection to hospitalisation ration (2%)</span></span>
<span>  <span class="op">(</span>\<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span> <span class="op">*</span> <span class="fl">0.02</span><span class="op">)</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">reporting_pmf</span><span class="op">)</span></span></code></pre></div>
</details><div class="figure">
<img src="figures/single-timeseries-rt-estimation-unnamed-chunk-13-1.png" alt=""><p class="caption">Probability mass function of the assumed latent (unobserved) reporting distribution</p>
</div>
<p>The last part of the model to define is the remaining part of the ascertainment model for expected hospitalisations. As we have already defined the base ascertainment ratio (i.e. the 2% infection to hospitalisation ratio) we only need to define the day of the week random effect. We can do this using the formula interface as follows,</p>
<details class="chunk-details" open><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">observation_formula</span> <span class="op">&lt;-</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">day_of_week</span><span class="op">)</span></span></code></pre></div>
</details><p>Finally, we can combine these four parts of the model to define the expected hospitalisations by date of positive test. We do this using the <code><a href="../reference/enw_expectation.html">epinowcast::enw_expectation()</a></code> function as follows,</p>
<details class="chunk-details" open><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">expectation_module</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/partial.html" class="external-link">partial</a></span><span class="op">(</span></span>
<span>  <span class="fu">epinowcast</span><span class="fu">::</span><span class="va"><a href="../reference/enw_expectation.html">enw_expectation</a></span>,</span>
<span>  r <span class="op">=</span> <span class="va">rt_formula</span>,</span>
<span>  generation_time <span class="op">=</span> <span class="va">gt_pmf</span>,</span>
<span>  latent_reporting_delay <span class="op">=</span> <span class="va">reporting_pmf</span>,</span>
<span>  observation <span class="op">=</span> <span class="va">observation_formula</span></span>
<span><span class="op">)</span></span></code></pre></div>
</details>
</div>
</div>
<div class="section level3">
<h3 id="delay-distribution">Delay distribution<a class="anchor" aria-label="anchor" href="#delay-distribution"></a>
</h3>
<div class="section level4">
<h4 id="defining-the-delay-distribution">Defining the delay distribution<a class="anchor" aria-label="anchor" href="#defining-the-delay-distribution"></a>
</h4>
<p>Given case counts both by date of reference and by date of report, we can estimate the reporting delay distribution directly and jointly with the underlying process model, rather than relying on external estimates from other sources (though we may want to account for external information in our priors).</p>
<p>We consider the reporting delay to follow a <span class="math inline">\(\text{LogNormal} \left(\mu^d, \sigma^d \right)\)</span> distribution, with parameters</p>
<p><span class="math display">\[\begin{align}
  \mu^d &amp;\sim \text{Normal} \left(0, 1 \right) \\
  \sigma^d &amp;\sim \text{Half-Normal} \left(0, 1 \right).
\end{align}\]</span></p>
<p>This distribution is discretised into daily probabilities <span class="math inline">\(p_{t,d}\)</span> and adjusted for the maximum delay, see <code><a href="../articles/distributions.html">vignette("distributions")</a></code> for details.</p>
</div>
<div class="section level4">
<h4 id="specifying-the-model-using-epinowcastenw_reference">Specifying the model using <code>epinowcast::enw_reference()</code><a class="anchor" aria-label="anchor" href="#specifying-the-model-using-epinowcastenw_reference"></a>
</h4>
<p>We can define the reporting delay distribution using the <code><a href="../reference/enw_reference.html">epinowcast::enw_reference()</a></code> function as follows,</p>
<details class="chunk-details" open><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">reference_module</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/partial.html" class="external-link">partial</a></span><span class="op">(</span><span class="va">enw_reference</span>, <span class="op">~</span><span class="fl">1</span>, distribution <span class="op">=</span> <span class="st">"lognormal"</span><span class="op">)</span></span></code></pre></div>
</details>
</div>
</div>
<div class="section level3">
<h3 id="observation-model-and-nowcast">Observation model and nowcast<a class="anchor" aria-label="anchor" href="#observation-model-and-nowcast"></a>
</h3>
<div class="section level4">
<h4 id="defining-the-observation-model">Defining the observation model<a class="anchor" aria-label="anchor" href="#defining-the-observation-model"></a>
</h4>
<p>Expected notifications by date of positive test (<span class="math inline">\(t\)</span>) and reporting date can now be found by multiplying expected final notifications by date of positive test for each <span class="math inline">\(t\)</span> with the probability of reporting for each day of delay (<span class="math inline">\(p_{t,d}\)</span>). We assume a Poisson observation model and produce a nowcast of final observed hospitalisations at each reference date by summing posterior estimates for unobserved notification and observed notifications for that reference date.</p>
<p><span class="math display">\[\begin{align}
  n_{t,d} \mid \lambda_{t},p_{t,d}  &amp;\sim \text{Poisson} \left(\lambda_{t} \times p_{t,d} \right),\ t=1,...,T. \\
  N_{t} &amp;= \sum_{d=0}^{D} n_{t,d}
\end{align}\]</span></p>
</div>
<div class="section level4">
<h4 id="specifying-the-model-using-epinowcastenw_obs">Specifying the model using <code>epinowcast::enw_obs()</code><a class="anchor" aria-label="anchor" href="#specifying-the-model-using-epinowcastenw_obs"></a>
</h4>
<details class="chunk-details" open><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">obs_module</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/partial.html" class="external-link">partial</a></span><span class="op">(</span><span class="va">enw_obs</span>, family <span class="op">=</span> <span class="st">"poisson"</span><span class="op">)</span></span></code></pre></div>
</details>
</div>
</div>
</div>
<div class="section level2">
<h2 id="fitting-the-model-to-covid-19-hospitalisations-in-germany">Fitting the model to COVID-19 hospitalisations in Germany<a class="anchor" aria-label="anchor" href="#fitting-the-model-to-covid-19-hospitalisations-in-germany"></a>
</h2>
<div class="section level3">
<h3 id="preprocess-the-data">Preprocess the data<a class="anchor" aria-label="anchor" href="#preprocess-the-data"></a>
</h3>
<p>Before fitting the model we have just defined we need to preprocess the data in order for it to be in the correct format to work with <code>epinowcast</code> and to produce metadata that describes aspects of the data we use in the model (for example the maximum delay, the number of groups, and the number of observations in each group). We do this using the <code><a href="../reference/enw_preprocess_data.html">enw_preprocess_data()</a></code> function as follows for both the real-time and retrospective datasets. Note that we set <code>max_delay = 30</code> to constrain the modelled maximum delay to 30 days. This is a pragmatic choice to ensure that the model can be fit in a reasonable amount of time, but we could also set this to be longer if we wanted to and if the data suggested a longer delay was possible.</p>
<details class="chunk-details" open><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rt_germany_pobs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/enw_preprocess_data.html">enw_preprocess_data</a></span><span class="op">(</span><span class="va">rt_germany</span>, max_delay <span class="op">=</span> <span class="fl">30</span><span class="op">)</span></span>
<span><span class="va">rt_germany_pobs</span></span>
<span><span class="co">#&gt;                     obs          new_confirm             latest</span></span>
<span><span class="co">#&gt; 1: &lt;data.table[1425x8]&gt; &lt;data.table[1425x9]&gt; &lt;data.table[62x8]&gt;</span></span>
<span><span class="co">#&gt;    missing_reference  reporting_triangle      metareference          metareport</span></span>
<span><span class="co">#&gt; 1: &lt;data.table[0x4]&gt; &lt;data.table[62x32]&gt; &lt;data.table[62x8]&gt; &lt;data.table[91x10]&gt;</span></span>
<span><span class="co">#&gt;             metadelay time snapshots by groups max_delay   max_date timestep</span></span>
<span><span class="co">#&gt; 1: &lt;data.table[30x5]&gt;   62        62         1        30 2021-07-01      day</span></span></code></pre></div>
</details><p>and do the same for the retrospective data</p>
<details class="chunk-details" open><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">retro_germany_pobs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/enw_preprocess_data.html">enw_preprocess_data</a></span><span class="op">(</span><span class="va">retro_germany</span>, max_delay <span class="op">=</span> <span class="fl">30</span><span class="op">)</span></span>
<span><span class="va">retro_germany_pobs</span></span>
<span><span class="co">#&gt;                     obs          new_confirm             latest</span></span>
<span><span class="co">#&gt; 1: &lt;data.table[1860x8]&gt; &lt;data.table[1860x9]&gt; &lt;data.table[62x8]&gt;</span></span>
<span><span class="co">#&gt;    missing_reference  reporting_triangle      metareference</span></span>
<span><span class="co">#&gt; 1: &lt;data.table[0x4]&gt; &lt;data.table[62x32]&gt; &lt;data.table[62x8]&gt;</span></span>
<span><span class="co">#&gt;              metareport          metadelay time snapshots by groups max_delay</span></span>
<span><span class="co">#&gt; 1: &lt;data.table[120x10]&gt; &lt;data.table[30x5]&gt;   62        62         1        30</span></span>
<span><span class="co">#&gt;      max_date timestep</span></span>
<span><span class="co">#&gt; 1: 2021-07-30      day</span></span></code></pre></div>
</details>
</div>
<div class="section level3">
<h3 id="fitting-the-epinowcast-model">Fitting the <code>epinowcast</code> model<a class="anchor" aria-label="anchor" href="#fitting-the-epinowcast-model"></a>
</h3>
<div class="section level4">
<h4 id="specifying-the-fitting-options">Specifying the fitting options<a class="anchor" aria-label="anchor" href="#specifying-the-fitting-options"></a>
</h4>
<p>Before we are ready to fit the model we need to first specify some fitting options for using <code>cmdstanr</code> (more information on these options can be found in the <code>cmdstanr</code> documentation). We use 2 chains with 2 threads per chain (so using 4 CPU cores in total) 500 warmup samples and 1000 iterations per chain. As this is a complex model we set <code>adapt_delta</code> to 0.98 (the default is 0.8) so that the Hamiltonian Monte Carlo sampler can explore the posterior distribution more efficiently. For the same reason, we have also set the <code>max_treedepth</code> to 15 (the default is 10). Finally, we set <code>save_warmup</code> to <code>FALSE</code> to save space (we don’t need the warmup samples for this analysis), and <code>pp</code> to <code>TRUE</code> so that we can use posterior predictive checks to assess the model fit.</p>
<details class="chunk-details" open><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_module</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/partial.html" class="external-link">partial</a></span><span class="op">(</span><span class="va">enw_fit_opts</span>,</span>
<span>  chains <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  parallel_chains <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  threads_per_chain <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  iter_warmup <span class="op">=</span> <span class="fl">500</span>,</span>
<span>  iter_sampling <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  adapt_delta <span class="op">=</span> <span class="fl">0.98</span>,</span>
<span>  max_treedepth <span class="op">=</span> <span class="fl">15</span>,</span>
<span>  save_warmup <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  pp <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  show_messages <span class="op">=</span> <span class="cn">FALSE</span>, <span class="co"># set this to TRUE to show fitting messages</span></span>
<span>  refresh <span class="op">=</span> <span class="fl">0</span> <span class="co"># remove this to show fitting progress</span></span>
<span><span class="op">)</span></span></code></pre></div>
</details><div class="alert alert-warning">
<p>If you have more than 4 CPU cores available you can increase the number of threads per chain to make use of these additional cores. For example if you have 8 CPU cores available you could set <code>threads_per_chain = 4</code> to use all 8 cores (as there are 2 chains).</p>
</div>
</div>
<div class="section level4">
<h4 id="compiling-the-model">Compiling the model<a class="anchor" aria-label="anchor" href="#compiling-the-model"></a>
</h4>
<p>We also need to compile the model using <code>cmdstanr</code> before fitting it (we only have to do this once after installing the package). In order for this line to work you should have followed the installation guide in the <a href="https://package.epinowcast.org">README</a>. This will take around a minute to run when called for the first time.</p>
<details class="chunk-details" open><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">epinowcast_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/enw_model.html">enw_model</a></span><span class="op">(</span>profile <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
</details>
</div>
<div class="section level4">
<h4 id="fitting-the-model">Fitting the model<a class="anchor" aria-label="anchor" href="#fitting-the-model"></a>
</h4>
<p>Now we are ready to bring together all the modules we have specified, combine them with the model we have just compiled, and fit our synthetic data. We first fit to the data that would have been available in real-time,</p>
<details class="chunk-details" open><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">germany_nowcast</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/epinowcast.html">epinowcast</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">rt_germany_pobs</span>,</span>
<span>  expectation <span class="op">=</span> <span class="fu">expectation_module</span><span class="op">(</span>data <span class="op">=</span> <span class="va">rt_germany_pobs</span><span class="op">)</span>,</span>
<span>  reference <span class="op">=</span> <span class="fu">reference_module</span><span class="op">(</span>data <span class="op">=</span> <span class="va">rt_germany_pobs</span><span class="op">)</span>,</span>
<span>  obs <span class="op">=</span> <span class="fu">obs_module</span><span class="op">(</span>data <span class="op">=</span> <span class="va">rt_germany_pobs</span><span class="op">)</span>,</span>
<span>  fit <span class="op">=</span> <span class="fu">fit_module</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  model <span class="op">=</span> <span class="va">epinowcast_model</span></span>
<span><span class="op">)</span></span></code></pre></div>
</details><div class="alert alert-warning">
<p>Fitting this model with the default options will take around 5 minutes to run on a laptop with 4 CPU cores. If you have more CPU cores available you can reduce the time it takes to fit the model by increasing the number of threads per chain (see the <a href="#fitting-the-epinowcast-model">fitting options</a> section above).</p>
</div>
<p>and then on the retrospectively observed data.</p>
<details class="chunk-details" open><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">retro_germany_nowcast</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/epinowcast.html">epinowcast</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">retro_germany_pobs</span>,</span>
<span>  expectation <span class="op">=</span> <span class="fu">expectation_module</span><span class="op">(</span>data <span class="op">=</span> <span class="va">retro_germany_pobs</span><span class="op">)</span>,</span>
<span>  reference <span class="op">=</span> <span class="fu">reference_module</span><span class="op">(</span>data <span class="op">=</span> <span class="va">retro_germany_pobs</span><span class="op">)</span>,</span>
<span>  obs <span class="op">=</span> <span class="fu">obs_module</span><span class="op">(</span>data <span class="op">=</span> <span class="va">retro_germany_pobs</span><span class="op">)</span>,</span>
<span>  fit <span class="op">=</span> <span class="fu">fit_module</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  model <span class="op">=</span> <span class="va">epinowcast_model</span></span>
<span><span class="op">)</span></span></code></pre></div>
</details><div class="alert alert-warning">
<p>You may see a number of warning messages from <code>cmdstanr</code> when fitting the model. These generally occur when the model is being initialised and are due to this process not currently being optimised in <code>epinowcast</code>. The model should still fit correctly unless these warnings continue into the fitting process (outside of the warmup phase). This is something we are actively working on improving in future versions of <code>epinowcast</code>.</p>
</div>
</div>
</div>
<div class="section level3">
<h3 id="visualising-the-nowcast">Visualising the Nowcast<a class="anchor" aria-label="anchor" href="#visualising-the-nowcast"></a>
</h3>
<div class="section level4">
<h4 id="plotting-the-nowcast-based-on-real-time-data">Plotting the nowcast based on real-time data<a class="anchor" aria-label="anchor" href="#plotting-the-nowcast-based-on-real-time-data"></a>
</h4>
<p>We first plot the nowcast based on real-time data. Effectively here we are trying to use our model to estimate the hospitalisations that will ultimately be reported based on the data that is currently available. We can compare this to the most recent observations to see how well the model is doing.</p>
<details class="chunk-details" open><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span></span>
<span>  <span class="va">germany_nowcast</span>, <span class="va">latest_germany_hosp</span><span class="op">[</span><span class="va">reference_date</span> <span class="op">&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2021-06-01"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="op">)</span></span></code></pre></div>
</details><div class="figure">
<img src="figures/single-timeseries-rt-estimation-plot-germany-nowcast-1.png" alt=""><p class="caption">Nowcast of hospitalisations in Germany based on real-time data</p>
</div>
<p>Internally, this plotting function (see <code>?plot.epinowcast()</code>) sums observed data and posterior estimates for unobserved data to produce a nowcast of the number of hospitalisations that will ultimately be reported.</p>
<p>In this instance, the model has done a good job of estimating the number of hospitalisations that will ultimately be reported based on the data that is currently available. This is not always the case, and the model can sometimes over or under estimate the number of hospitalisations that will ultimately be reported.</p>
<div class="alert alert-warning">
<p>An important thing to note here is that this model is clearly not perfect with more complete data being less well estimated by the model. This likely indicates some misspecification in the reporting delay model which could be fixed by making it more complex or even by making it entirely non-parametric (vs being based on a LogNormal).</p>
</div>
</div>
<div class="section level4">
<h4 id="plotting-the-nowcast-based-on-retrospective-data">Plotting the nowcast based on retrospective data<a class="anchor" aria-label="anchor" href="#plotting-the-nowcast-based-on-retrospective-data"></a>
</h4>
<p>We can also plot the nowcast based on the retrospective data. As this plot uses observed data where available this is effectively plotting observed data after a 30 day delay (as this was the maximum we specified) compared to data that will ultimately be observed. This can be used to get a feel for how well specified our maximum delay is. Here we see that a small number of hospitalisations will be reported after 30 days. This will impact the performance of even an ideal model as it will not be able to predict these hospitalisations and so should be accounted for in the model evaluation.</p>
<details class="chunk-details" open><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span></span>
<span>  <span class="va">retro_germany_nowcast</span>,</span>
<span>  <span class="va">latest_germany_hosp</span><span class="op">[</span><span class="va">reference_date</span> <span class="op">&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2021-06-01"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="op">)</span></span></code></pre></div>
</details><div class="figure">
<img src="figures/single-timeseries-rt-estimation-plot-retro-germany-nowcast-1.png" alt=""><p class="caption">Nowcast of hospitalisations in Germany based on retrospective data</p>
</div>
</div>
</div>
<div class="section level3">
<h3 id="posterior-predictions-for-cases-by-date-of-positive-test-and-report">Posterior predictions for cases by date of positive test and report<a class="anchor" aria-label="anchor" href="#posterior-predictions-for-cases-by-date-of-positive-test-and-report"></a>
</h3>
<p>To better understand the fit of the model to data we can instead plot the posterior predictions for the observed data. This is effectively the same as the plot above but instead of plotting the posterior predictions for the unobserved data we plot the posterior predictions for the observed data. This can be used to get a feel for how well the model is able to predict the observed data. Rather than using the build in plot function (by changing <code>type = "posterior_prediction"</code>) we instead use <code><a href="../reference/enw_plot_pp_quantiles.html">enw_plot_pp_quantiles()</a></code> so we can control the number of references dates we plot (as otherwise the plot will be quite overwhelming!).</p>
<details class="chunk-details" open><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plot_select_pp_dates</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">nowcast</span>, <span class="va">dates</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">nowcast</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"posterior_prediction"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="op">(</span>\<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">[</span><span class="va">reference_date</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">dates</span><span class="op">]</span><span class="op">)</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/enw_plot_pp_quantiles.html">enw_plot_pp_quantiles</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">reference_date</span><span class="op">)</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu">plot_select_pp_dates</span><span class="op">(</span></span>
<span>  <span class="va">retro_germany_nowcast</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2021-05-01"</span>, <span class="st">"2021-05-14"</span>, <span class="st">"2021-06-01"</span>, <span class="st">"2021-07-01"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</details><div class="figure">
<img src="figures/single-timeseries-rt-estimation-plot-retro-germany-nowcast-obs-1.png" alt=""><p class="caption">Posterior predictions of hospitalisations in Germany based on retrospective data</p>
</div>
<div class="alert alert-warning">
<p>It is clear from this plot that for these example dates the model is in the main able to predict the observed data well. However, there are also some aspects of the data that the model is less well able to predict, in particular the apparent periodicity in the reporting delay. This is likely due to the model not being able to account for the day of the week reporting periodicity. This could be fixed by adding a day of the week random effect to the reporting delay model which we demonstrate in the <a href="https://package.epinowcast.org">package README</a>.</p>
</div>
</div>
<div class="section level3">
<h3 id="real-time-and-retrospective-estimates-of-the-effective-reproduction-number">Real-time and retrospective estimates of the effective reproduction number<a class="anchor" aria-label="anchor" href="#real-time-and-retrospective-estimates-of-the-effective-reproduction-number"></a>
</h3>
<p>A key output of the model is the posterior distribution of the effective reproduction number. We can plot this for both the real-time and retrospective data to see how the estimates change as more data becomes available. Ideally, we would hope that the real-time estimates would overlap with the retrospective estimates. This would indicate that our model is able to accurately estimate hospitalisations that will be ultimately reported based on those that have already been reported.</p>
<details class="chunk-details"><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">get_rt_posterior</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">nowcast</span>, <span class="va">expectation</span> <span class="op">=</span> <span class="va">expectation_module</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">rt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/enw_posterior.html">enw_posterior</a></span><span class="op">(</span><span class="va">nowcast</span><span class="op">$</span><span class="va">fit</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, variables <span class="op">=</span> <span class="st">"r"</span><span class="op">)</span></span>
<span>  <span class="va">cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mean"</span>, <span class="st">"median"</span>, <span class="st">"q5"</span>, <span class="st">"q20"</span>, <span class="st">"q80"</span>, <span class="st">"q95"</span><span class="op">)</span></span>
<span>  <span class="va">rt</span><span class="op">[</span>, <span class="op">(</span><span class="va">cols</span><span class="op">)</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">.SD</span>, <span class="va">exp</span><span class="op">)</span>, .SDcols <span class="op">=</span> <span class="va">cols</span><span class="op">]</span></span>
<span>  <span class="va">rt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span></span>
<span>    <span class="fu">expectation</span><span class="op">(</span>data <span class="op">=</span> <span class="va">nowcast</span><span class="op">)</span><span class="op">$</span><span class="va">data_raw</span><span class="op">$</span><span class="va">r</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span><span class="va">date</span><span class="op">)</span><span class="op">]</span>, <span class="va">rt</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">rt</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">rt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span></span>
<span>  <span class="fu">get_rt_posterior</span><span class="op">(</span><span class="va">germany_nowcast</span><span class="op">)</span><span class="op">[</span>, <span class="va">Data</span> <span class="op">:=</span> <span class="st">"Real-time"</span><span class="op">]</span>,</span>
<span>  <span class="fu">get_rt_posterior</span><span class="op">(</span><span class="va">retro_germany_nowcast</span><span class="op">)</span><span class="op">[</span>, <span class="va">Data</span> <span class="op">:=</span> <span class="st">"Retrospective"</span><span class="op">]</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">rt</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, col <span class="op">=</span> <span class="va">Data</span>, fill <span class="op">=</span> <span class="va">Data</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">median</span><span class="op">)</span>, linewidth <span class="op">=</span> <span class="fl">1</span>, alpha <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">mean</span><span class="op">)</span>, linetype <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">q5</span>, ymax <span class="op">=</span> <span class="va">q95</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.2</span>, linewidth <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">q20</span>, ymax <span class="op">=</span> <span class="va">q80</span>, col <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">1</span>, linetype <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>trans <span class="op">=</span> <span class="st">"log"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_fill_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Dark2"</span>, aesthetics <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"color"</span>, <span class="st">"fill"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Date of infection"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Effective reproduction number"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span></code></pre></div>
</details><div class="figure">
<img src="figures/single-timeseries-rt-estimation-plot-germany-rt-1.png" alt=""><p class="caption">Real-time and retrospective estimates of the effective reproduction number in Germany</p>
</div>
<p>Here we see good agreement between the real-time and retrospective estimates of the effective reproduction number for dates earlier in time as we would expect given that this data should be near complete in both models. Closer to the date of estimation we see that the real-time model does a good job estimating the trend shown by the retrospective model but has a tendency to overpredict. This could be caused by changes in the reporting delay over time, by the model not being able to account for the day of the week reporting periodicity, or by the model not being able to account for the change in the underlying process over time.</p>
</div>
<div class="section level3">
<h3 id="estimates-of-the-delay-from-testing-positive-to-hospitalisation-both-in-real-time-and-retrospectively">Estimates of the delay from testing positive to hospitalisation both in real-time and retrospectively<a class="anchor" aria-label="anchor" href="#estimates-of-the-delay-from-testing-positive-to-hospitalisation-both-in-real-time-and-retrospectively"></a>
</h3>
<p>We can also plot the posterior distribution of the delay from testing positive to hospitalisation. This is the delay that is used to estimate the number of hospitalisations that will ultimately be reported based on the number of positive tests that have been reported. We can plot this for both the real-time and retrospective data to see how the estimates change as more data becomes available. Ideally, we would hope that the real-time estimates would overlap with the retrospective estimates. This would indicate that our model is able to accurately estimate hospitalisations that will be ultimately reported based on those that have already been reported.</p>
<details class="chunk-details"><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">extract_epinowcast_cdf</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">nowcast</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">draws</span> <span class="op">&lt;-</span> <span class="va">nowcast</span> <span class="op">|&gt;</span></span>
<span>    <span class="op">(</span>\<span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span>      <span class="va">x</span><span class="op">$</span><span class="va">fit</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="fu">draws</span><span class="op">(</span>variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"refp_mean"</span>, <span class="st">"refp_sd"</span><span class="op">)</span>, format <span class="op">=</span> <span class="st">"df"</span><span class="op">)</span></span>
<span>    <span class="op">)</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/as.data.table.html" class="external-link">as.data.table</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">draws</span><span class="op">[</span></span>
<span>    ,</span>
<span>    <span class="va">cdf</span> <span class="op">:=</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html" class="external-link">map2</a></span><span class="op">(</span></span>
<span>      <span class="va">`refp_mean[1]`</span>, <span class="va">`refp_sd[1]`</span>,</span>
<span>      <span class="op">~</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></span><span class="op">(</span></span>
<span>        delay <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">30</span>, cdf <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Lognormal.html" class="external-link">plnorm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">30</span>, <span class="va">.x</span>, <span class="va">.y</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/stats/Lognormal.html" class="external-link">plnorm</a></span><span class="op">(</span><span class="fl">30</span>, <span class="va">.x</span>, <span class="va">.y</span><span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">]</span></span>
<span>  <span class="va">draws</span> <span class="op">&lt;-</span> <span class="va">draws</span><span class="op">[</span>, <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/rbindlist.html" class="external-link">rbindlist</a></span><span class="op">(</span><span class="va">cdf</span><span class="op">)</span><span class="op">]</span></span>
<span>  <span class="va">draws</span> <span class="op">&lt;-</span> <span class="va">draws</span><span class="op">[</span>,</span>
<span>    <span class="fu">.</span><span class="op">(</span></span>
<span>      mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">cdf</span><span class="op">)</span>,</span>
<span>      lower_90 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">cdf</span>, probs <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span>,</span>
<span>      upper_90 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">cdf</span>, probs <span class="op">=</span> <span class="fl">0.95</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    by <span class="op">=</span> <span class="st">"delay"</span></span>
<span>  <span class="op">]</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">nowcast_cdf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="st">"Real-time"</span> <span class="op">=</span> <span class="va">germany_nowcast</span>,</span>
<span>  <span class="st">"Retrospective"</span> <span class="op">=</span> <span class="va">retro_germany_nowcast</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">extract_epinowcast_cdf</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/rbindlist.html" class="external-link">rbindlist</a></span><span class="op">(</span>idcol <span class="op">=</span> <span class="st">"Data"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">nowcast_cdf</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">delay</span>, y <span class="op">=</span> <span class="va">mean</span>, col <span class="op">=</span> <span class="va">Data</span>, fill <span class="op">=</span> <span class="va">Data</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1.1</span>, alpha <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">lower_90</span>, ymax <span class="op">=</span> <span class="va">upper_90</span><span class="op">)</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">0.25</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_fill_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Dark2"</span>, aesthetics <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"color"</span>, <span class="st">"fill"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span></span>
<span>    fill <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>    col <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Delay between positive test and hospitalisation"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Cumulative density function of the reporting distribution"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
</details><div class="figure">
<img src="figures/single-timeseries-rt-estimation-plot-germany-delay-1.png" alt=""><p class="caption">Real-time and retrospective estimates of the delay from testing positive to hospitalisation in Germany</p>
</div>
<p>The estimates are a fairly good match indicating that the delay is being well estimated by the real-time model compared to the retrospective model and that the delay is unlikely to be changing rapidly over time in this example (as otherwise we would expect the estimated delays to diverge over time).</p>
</div>
<div class="section level3">
<h3 id="estimates-of-the-number-of-expected-hospitalisations-both-in-real-time-and-retrospectively">Estimates of the number of expected hospitalisations both in real-time and retrospectively<a class="anchor" aria-label="anchor" href="#estimates-of-the-number-of-expected-hospitalisations-both-in-real-time-and-retrospectively"></a>
</h3>
<p>We can also plot the posterior predictions for the number of expected hospitalisations. This is the number of hospitalisations that would be reported if there was no observation error. We can compare this to the number of hospitalisations that are ultimately reported to see how well the model is doing.</p>
<p>Retrospectively, we would expect the model to fit very well to this data with any differences being due to the observation error. If this is not the case it indicates we may need to revisit our expected hospitalisation model specification to make it closer to the generative process of the data we have.</p>
<p>In real-time, we would expect the model to fit less well to this data as it is trying to estimate the number of hospitalisations that will ultimately be reported based on the data that is currently available (i.e. it also has to account for the reporting delay which is now partially unobserved).</p>
<details class="chunk-details"><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">get_expected_infections</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">nowcast</span>, <span class="va">expectation</span> <span class="op">=</span> <span class="va">expectation_module</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">exp_cases</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/enw_posterior.html">enw_posterior</a></span><span class="op">(</span></span>
<span>    <span class="va">nowcast</span><span class="op">$</span><span class="va">fit</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,</span>
<span>    variables <span class="op">=</span> <span class="st">"exp_lobs"</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="va">cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mean"</span>, <span class="st">"median"</span>, <span class="st">"q5"</span>, <span class="st">"q20"</span>, <span class="st">"q80"</span>, <span class="st">"q95"</span><span class="op">)</span></span>
<span>  <span class="va">exp_cases</span><span class="op">[</span>, <span class="op">(</span><span class="va">cols</span><span class="op">)</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">.SD</span>, <span class="va">exp</span><span class="op">)</span>, .SDcols <span class="op">=</span> <span class="va">cols</span><span class="op">]</span></span>
<span>  <span class="va">exp_cases</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span></span>
<span>    <span class="fu">expectation</span><span class="op">(</span>data <span class="op">=</span> <span class="va">nowcast</span><span class="op">)</span><span class="op">$</span><span class="va">data_raw</span><span class="op">$</span><span class="va">observation</span>,</span>
<span>    <span class="va">exp_cases</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">exp_cases</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">exp_cases</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span></span>
<span>  <span class="fu">get_expected_infections</span><span class="op">(</span><span class="va">germany_nowcast</span><span class="op">)</span><span class="op">[</span>, <span class="va">Data</span> <span class="op">:=</span> <span class="st">"Real-time"</span><span class="op">]</span>,</span>
<span>  <span class="fu">get_expected_infections</span><span class="op">(</span><span class="va">retro_germany_nowcast</span><span class="op">)</span><span class="op">[</span>, <span class="va">Data</span> <span class="op">:=</span> <span class="st">"Retrospective"</span><span class="op">]</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">exp_cases</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/enw_latest_data.html">enw_latest_data</a></span><span class="op">(</span><span class="va">germany_hosp</span><span class="op">)</span><span class="op">[</span>, <span class="va">date</span> <span class="op">:=</span> <span class="va">reference_date</span><span class="op">]</span><span class="op">[</span></span>
<span>  <span class="va">exp_cases</span>,</span>
<span>  on <span class="op">=</span> <span class="st">"date"</span></span>
<span><span class="op">]</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">exp_cases</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, fill <span class="op">=</span> <span class="va">Data</span>, col <span class="op">=</span> <span class="va">Data</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">confirm</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"Black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">median</span><span class="op">)</span>, linewidth <span class="op">=</span> <span class="fl">1</span>, alpha <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">mean</span><span class="op">)</span>, linetype <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">q5</span>, ymax <span class="op">=</span> <span class="va">q95</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.2</span>, linewidth <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">q20</span>, ymax <span class="op">=</span> <span class="va">q80</span>, col <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Date of positive test"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Expected hospitalisations"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_fill_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Dark2"</span>, aesthetics <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"color"</span>, <span class="st">"fill"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span></code></pre></div>
</details><div class="figure">
<img src="figures/single-timeseries-rt-estimation-plot-germany-reported-cases-1.png" alt=""><p class="caption">Real-time and retrospective estimates of the number of expected hospitalisations in Germany</p>
</div>
<p>As expected the retrospective estimates fit very well to the data. The real-time estimates are slightly less good, but still capture the recent change in trend in the data which would not be possible without a nowcast (as estimates would be biased towards underpredicting due to the delay in reporting leading to right truncation).</p>
</div>
</div>
<div class="section level2">
<h2 id="wrapping-up">Wrapping up<a class="anchor" aria-label="anchor" href="#wrapping-up"></a>
</h2>
<div class="section level3 unnumbered alert alert-primary">
<h3 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h3>
<p>In this case study we have shown how to use <code>epinowcast</code> to estimate the effective reproduction number and the expected number of latent and reported cases from right truncated data.</p>
<p>We have also shown how to use the package to perform retrospective and real-time nowcasts which can be a useful way of understanding the real-time
performance of the model.</p>
</div>
<div class="alert alert-secondary">
<div class="section level3 unnumbered">
<h3 id="strengths">Strengths<a class="anchor" aria-label="anchor" href="#strengths"></a>
</h3>
<ul>
<li>We have used a single model to estimate the effective reproduction number and the expected number of latent and reported cases from right truncated data. This means that we have propagated uncertainty from the estimation of the effective reproduction number into the estimation of the expected number of latent and reported cases which would be difficult using a multi-stage approach.</li>
<li>We have used a flexible model for the effective reproduction number which allows us to estimate the effective reproduction number over time and to incorporate uncertainty in the estimation of the effective reproduction number into the estimation of the expected number of latent and reported cases.</li>
<li>We have accounted for the delay from infection to hospitalisation and the delay from hospitalisation to reporting in the estimation of the expected number of reported cases. This means that reproduction number estimates
are currently indexed to the date of infection.</li>
</ul>
</div>
<div class="section level3 unnumbered">
<h3 id="limitations">Limitations<a class="anchor" aria-label="anchor" href="#limitations"></a>
</h3>
<ul>
<li>Assumed a known and static generation time distribution and latent reporting delay distribution. In reality these would need to be estimated from data, have uncertainty, and be liable to change over time.</li>
<li>Used a fixed parametric reporting delay distribution. In reality this would likely vary over time and depend on things like day of the week reporting effects. This could be addressed by using a more flexible reporting delay distribution which is supported by <code>epinowcast</code>.</li>
<li>Used an observation model that does not account for overdispersion in the number of reported cases. This could be addressed by using a more flexible observation model which is supported by <code>epinowcast</code>.</li>
</ul>
</div>
<div class="section level3 unnumbered">
<h3 id="alternative-packages">Alternative packages<a class="anchor" aria-label="anchor" href="#alternative-packages"></a>
</h3>
<ul>
<li>
<a href="https://epiforecasts.io/EpiNow2" class="external-link">EpiNow2</a>: A precursor to <code>epinowcast</code> developed by members of the <code>epinowcast</code> community. It is a flexible toolset for real-time analysis of infectious diseases. It is less complex than <code>epinowcast</code> with a focus on robust default settings but is also less flexible. Over time its functionality will be incorporated into <code>epinowcast</code>.</li>
<li>
<a href="https://imperialcollegelondon.github.io/epidemia/index.html" class="external-link">epidemia</a>: This is another flexible package for estimating the effective reproduction number and forecasting. It is designed to be more flexible than <code>EpiNow2</code>, in a similar way to <code>epinowcast</code>, but is potentially more difficult to use. It also generally has less functionality for dealing with delays than <code>epinowcast</code>. However, as it is an extension of <code>rstanarm</code> it comes with a number of useful features and a familiar interface for users of <code>rstanarm</code>
</li>
<li>
<a href="https://cran.r-project.org/web/packages/EpiEstim/index.html" class="external-link">EpiEstim</a>: This is a more mature package for estimating the effective reproduction number. It exploits a mathematically relationship to fit the renewal equation with uncertainty very quickly but is not currently able to handle reporting delays or other aspects of real-world data that we have discussed in this case study. It is also not able to perform nowcasts. However, it is a useful package for estimating the effective reproduction number in settings where these aspects are not important or where they can be handled by other means.</li>
</ul>
</div>
</div>
</div>
<div class="section level2 unnumbered">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" line-spacing="2">
<div id="ref-Fraser2007" class="csl-entry">
1. Fraser, C. (2007). Estimating individual and household reproduction numbers in an emerging epidemic. <em>PLoS One</em>, <em>2</em>(8), e758. <a href="https://doi.org/10.1371/journal.pone.0000758" class="external-link">https://doi.org/10.1371/journal.pone.0000758</a>
</div>
<div id="ref-Cori2013" class="csl-entry">
2. Cori, A., Ferguson, N. M., Fraser, C., &amp; Cauchemez, S. (2013). A new framework and software to estimate time-varying reproduction numbers during epidemics. <em>Am. J. Epidemiol.</em>, <em>178</em>(9), 1505–1512. <a href="https://doi.org/10.1093/aje/kwt133" class="external-link">https://doi.org/10.1093/aje/kwt133</a>
</div>
<div id="ref-champredon" class="csl-entry">
3. Champredon, D., Dushoff, J., &amp; Earn, D. J. D. (2018). Equivalence of the <span>Erlang-Distributed</span> <span>SEIR</span> epidemic model and the renewal equation. <em>SIAM J. Appl. Math.</em>, <em>78</em>(6), 3258–3278. <a href="https://doi.org/10.1137/18M1186411" class="external-link">https://doi.org/10.1137/18M1186411</a>
</div>
<div id="ref-EpiNow2" class="csl-entry">
4. Abbott, S., Hellewell, J., Sherratt, K., Gostic, K., Hickson, J., Badr, H. S., DeWitt, M., Thompson, R., EpiForecasts, &amp; Funk, S. (2020). <em>EpiNow2: Estimate real-time case counts and time-varying epidemiological parameters</em>. <a href="https://doi.org/10.5281/zenodo.3957489" class="external-link">https://doi.org/10.5281/zenodo.3957489</a>
</div>
<div id="ref-Abbott2020" class="csl-entry">
5. Abbott, S., Hellewell, J., Thompson, R. N., Sherratt, K., Gibbs, H. P., Bosse, N. I., Munday, J. D., Meakin, S., Doughty, E. L., Chun, J. Y., Chan, Y.-W. D., Finger, F., Campbell, P., Endo, A., Pearson, C. A. B., Gimma, A., Russell, T., Flasche, S., Kucharski, A. J., … CMMID COVID modelling group. (2020). Estimating the time-varying reproduction number of <span>SARS-CoV-2</span> using national and subnational case counts. <em>Wellcome Open Res.</em>, <em>5</em>, 112. <a href="https://doi.org/10.12688/wellcomeopenres.16006.2" class="external-link">https://doi.org/10.12688/wellcomeopenres.16006.2</a>
</div>
<div id="ref-Bhatt2020" class="csl-entry">
6. Bhatt, S., Ferguson, N., Flaxman, S., Gandy, A., Mishra, S., &amp; Scott, J. A. (2020). <em><span>Semi-Mechanistic</span> bayesian modeling of <span>COVID-19</span> with renewal processes</em>. <a href="https://arxiv.org/abs/2012.00394" class="external-link">https://arxiv.org/abs/2012.00394</a>
</div>
<div id="ref-Lison2022" class="csl-entry">
7. Lison, A. (n.d.). <em>Nowcast-transmission</em>. Github.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by <a href="https://www.samabbott.co.uk/" class="external-link">Sam Abbott</a>, Adrian Lison, Sebastian Funk, Carl Pearson, Hugo Gruson, Felix Guenther.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.9000.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
