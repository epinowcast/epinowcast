<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Style Guide • epinowcast</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="apple-touch-icon-60x60.png"><script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Style Guide"><meta property="og:image" content="package.epinowcast.org/reference/figures/README-nowcast-1.png"><meta property="og:image:alt" content="An R package for flexible hierarchical nowcasting"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:creator" content="@seabbs"><meta name="twitter:site" content="@seabbs"><meta name="robots" content="noindex"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="index.html">epinowcast</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">0.2.3.2000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <h6 class="dropdown-header" data-toc-skip>Model details</h6>
    <a class="dropdown-item" href="articles/model.html">Model definition and implementation</a>
    <a class="dropdown-item" href="articles/distributions.html">Discretised distributions</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Case studies</h6>
    <a class="dropdown-item" href="articles/germany-age-stratified-nowcasting.html">Hierarchical nowcasting of age stratified COVID-19 hospitalisations in Germany</a>
    <a class="dropdown-item" href="articles/single-timeseries-rt-estimation.html">Estimating the effective reproduction number in real-time for a single timeseries with reporting delays</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/epinowcast/epinowcast/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-title-body">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="logo.png" class="logo" alt=""><h1>Style Guide</h1>
      <small class="dont-index">Source: <a href="https://github.com/epinowcast/epinowcast/blob/HEAD/STYLE_GUIDE.md" class="external-link"><code>STYLE_GUIDE.md</code></a></small>
    </div>

<div id="style-guide" class="section level1">

<p>This document outlines the style guide for the <code>epinowcast</code> package. This guide is a work in progress and will be updated as the package evolves. We welcome contributions to this guide and encourage you to raise issues or submit PRs if you have any suggestions.</p>
<p>In addition to this guide we also follow the <a href="https://style.tidyverse.org/" class="external-link">tidyverse style guide</a>. This guide is a subset of the <code>tidyverse</code> style guide and outlines the additional style requirements for the <code>epinowcast</code> package.</p>
<div class="section level2">
<h2 id="naming-conventions">Naming conventions<a class="anchor" aria-label="anchor" href="#naming-conventions"></a></h2>
<ul><li>We use a <code>enw_</code> prefix to delineate functions that are exported by the <code>epinowcast</code> package. This is to avoid conflicts with other packages and to make it clear to users which functions are part of the package.</li>
<li>The use of this prefix is not required for internal functions (i.e. functions that are not exported) or that are unlikely to have naming conflicts with other packages.</li>
</ul></div>
<div class="section level2">
<h2 id="dependencies">Dependencies<a class="anchor" aria-label="anchor" href="#dependencies"></a></h2>
<p>In general we aim to minimise dependencies on other packages where possible. This makes it easier to maintain the package and reduces the risk of breaking changes in other packages impacting our users. However, additional dependencies are sometimes necessary to improve the functionality of the package.</p>
<p>The following guidelines should be followed when using adding dependencies:</p>
<ul><li>Added to the <code>Imports</code> or <code>Suggests</code> field <code>DESCRIPTION</code> file in alphabetical order. A dependency should be an <code>Imports</code> if it is required for the package to function and a <code>Suggests</code> if it is only required for certain non-core functions or vignettes.</li>
<li>In the PR that adds the dependency this should be clearly stated in the PR description along with a justification for the dependency, the number and type of downstream dependencies, and an assessment of the risk of the dependency breaking. In general, the barrier for adding dependencies should be high but is lower for <code>Suggests</code> dependencies.</li>
</ul><p>More generally when adding functions from external packages (i.e. even if they are already a dependency) the following should be followed:</p>
<ul><li>Documented in function documentation using the <code>@importFrom</code> tag.</li>
<li>Used within functions using the <code>package::function</code> format (though we make exception for functions from <code>data.table</code> as these are all imported by <code>epinowcast</code>).</li>
</ul></div>
<div class="section level2">
<h2 id="input-types-and-checking">Input types and checking<a class="anchor" aria-label="anchor" href="#input-types-and-checking"></a></h2>
<ul><li>We support inputs that are coercible to <code>data.table</code> objects using <code><a href="https://Rdatatable.gitlab.io/data.table/reference/as.data.table.html" class="external-link">data.table::as.data.table()</a></code>. This includes <code>data.frame</code> and <code>tibble</code> objects. This should be clearly documented in the function documentation.</li>
<li>Any required inputs should be clearly documented in the function documentation.</li>
<li>We use an internal function <code><a href="reference/coerce_dt.html">coerce_dt()</a></code> to check inputs are coercible to <code>data.table</code> objects and have the correct columns. This function is used in all functions that take data as input. The following function demonstrates this pattern (note this requires the use of <code>devtools::load_all()</code> in the package directory):</li>
</ul><div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">print_dt</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">dt</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">dt</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/coerce_dt.html">coerce_dt</a></span><span class="op">(</span><span class="va">dt</span>, required_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"date"</span>, <span class="st">"cases"</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">dt</span><span class="op">[</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">print_dt</span><span class="op">(</span><span class="va">mtcars</span><span class="op">)</span></span>
<span><span class="co"># Error in epinowcast:::coerce_dt(dt, required_cols = c("date", "cases")) : </span></span>
<span><span class="co">#   The following columns are required: date, cases but are not present among mpg, cyl, disp, hp, drat, wt, qsec, vs, am, gear, carb</span></span>
<span><span class="co"># (all `required_cols`: date, cases)</span></span>
<span><span class="fu">print_dt</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>cases <span class="op">=</span> <span class="fl">1</span>, date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.Date</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#    cases       date</span></span>
<span><span class="co"># 1:     1 2023-04-27</span></span></code></pre></div>
<p>In general, we aim to check the inputs for all external facing functions. This is to ensure that the user is aware of any issues with the input data and to provide a consistent error message. See the documentation for <code><a href="reference/coerce_dt.html">coerce_dt()</a></code> for more details. It may also be helpful to review usage in the package more widely, for this <code>data-converters.R</code> is a sensible place to start.</p>
<ul><li>For external facing functions <code><a href="reference/coerce_dt.html">coerce_dt()</a></code> should generally not update by reference (i.e. <code>copy = TRUE</code> should be set, the default). In cases where users may benefit from updating by reference the external function should pass through the <code>copy</code> argument to <code><a href="reference/coerce_dt.html">coerce_dt()</a></code>.</li>
<li>However, those external functions may be invoked within other package functions, in which case <code><a href="reference/coerce_dt.html">coerce_dt()</a></code> can often update by reference (i.e. <code>copy = FALSE</code> should be set). This is to avoid unnecessary copying of data. For purely internal functions, <code><a href="reference/coerce_dt.html">coerce_dt()</a></code> can generally be used with <code>copy = FALSE</code>, again because copying is unnecessary.</li>
</ul></div>
<div class="section level2">
<h2 id="internal-data-manipulation">Internal data manipulation<a class="anchor" aria-label="anchor" href="#internal-data-manipulation"></a></h2>
<ul><li>
<code>data.table</code> objects are used for internal data manipulation. If you are unfamiliar with <code>data.table</code> please see the <a href="https://rdatatable.gitlab.io/data.table/index.html" class="external-link">documentation</a> and <a href="https://s3.amazonaws.com/assets.datacamp.com/img/blog/data+table+cheat+sheet.pdf" class="external-link">cheatsheet</a>. Prototype code may be written with other tools but will generally need be refactored to use <code>data.table</code> before submission (in PRs where help is needed with this please clearly state this).</li>
<li>We aim to use more readable vs efficient <code>data.table</code> syntax where there is a trade-off (of course the exact trade-off requirers developer judgement). For example, rather than bracket chaining we prefer the use of one-line statements with re-assignment. The following functions demonstrate these patterns:</li>
</ul><div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span>
<span><span class="co"># we prefer this</span></span>
<span><span class="va">dt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/as.data.table.html" class="external-link">as.data.table</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">)</span></span>
<span><span class="va">dt</span><span class="op">[</span>, <span class="va">mpg</span> <span class="op">:=</span> <span class="va">mpg</span> <span class="op">+</span> <span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">dt</span><span class="op">[</span><span class="va">mpg</span> <span class="op">&gt;</span> <span class="fl">20</span>, <span class="va">cyl</span> <span class="op">:=</span> <span class="fl">10</span><span class="op">]</span></span>
<span><span class="va">dt</span><span class="op">[</span>, <span class="va">cyl</span> <span class="op">:=</span> <span class="va">cyl</span> <span class="op">+</span> <span class="fl">1</span><span class="op">]</span></span>
<span><span class="co">#over this</span></span>
<span><span class="va">dt_chain</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/as.data.table.html" class="external-link">as.data.table</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">)</span><span class="op">[</span>, <span class="va">mpg</span> <span class="op">:=</span> <span class="va">mpg</span> <span class="op">+</span> <span class="fl">1</span><span class="op">]</span><span class="op">[</span><span class="va">mpg</span> <span class="op">&gt;</span> <span class="fl">20</span>, <span class="va">cyl</span> <span class="op">:=</span> <span class="fl">10</span><span class="op">]</span><span class="op">[</span>, <span class="va">cyl</span> <span class="op">:=</span> <span class="va">cyl</span> <span class="op">+</span> <span class="fl">1</span><span class="op">]</span></span></code></pre></div>
<ul><li>We also use <code>list</code> structures for more complex objects or where <code>data.table</code> is not appropriate. If the appropriate data structure is unclear for the problem at hand please flag this in the issue you are addressing or in the PR discussion.</li>
</ul></div>
<div class="section level2">
<h2 id="output-types">Output types<a class="anchor" aria-label="anchor" href="#output-types"></a></h2>
<ul><li>For external functions we aim for the output to be a <code>data.table</code> object if possible unless a custom class is used (which we generally aim to inherit from the <code>data.table</code> class). This is to ensure consistency with the input types and to allow for easy chaining of functions.</li>
<li>All returned <code>data.table</code> objects should be followed with <code>[]</code> as this ensures the object prints automatically. This holds for both internal and external functions in order to improve both the user and developer experience. The following functions demonstrate this pattern:</li>
</ul><div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">no_print_iris</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">dt</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">dt</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/coerce_dt.html">coerce_dt</a></span><span class="op">(</span><span class="va">dt</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">dt</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">print_iris</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">dt</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">dt</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/coerce_dt.html">coerce_dt</a></span><span class="op">(</span><span class="va">dt</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">dt</span><span class="op">[</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">no_print_iris</span><span class="op">(</span><span class="va">iris</span><span class="op">)</span></span>
<span><span class="fu">print_iris</span><span class="op">(</span><span class="va">iris</span><span class="op">)</span></span>
<span><span class="co">#      Sepal.Length Sepal.Width Petal.Length Petal.Width   Species</span></span>
<span><span class="co">#   1:          5.1         3.5          1.4         0.2    setosa</span></span>
<span><span class="co">#   2:          4.9         3.0          1.4         0.2    setosa</span></span>
<span><span class="co">#   3:          4.7         3.2          1.3         0.2    setosa</span></span>
<span><span class="co">#   4:          4.6         3.1          1.5         0.2    setosa</span></span>
<span><span class="co">#   5:          5.0         3.6          1.4         0.2    setosa</span></span>
<span><span class="co">#  ---                                                            </span></span>
<span><span class="co"># 146:          6.7         3.0          5.2         2.3 virginica</span></span>
<span><span class="co"># 147:          6.3         2.5          5.0         1.9 virginica</span></span>
<span><span class="co"># 148:          6.5         3.0          5.2         2.0 virginica</span></span>
<span><span class="co"># 149:          6.2         3.4          5.4         2.3 virginica</span></span>
<span><span class="co"># 150:          5.9         3.0          5.1         1.8 virginica</span></span></code></pre></div>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by <a href="https://www.samabbott.co.uk/" class="external-link">Sam Abbott</a>, Adrian Lison, Sebastian Funk, Carl Pearson, Hugo Gruson, Felix Guenther.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.9000.</p>
</div>

    </footer></div>

  

  

  </body></html>

