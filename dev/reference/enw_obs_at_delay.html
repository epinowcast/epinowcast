<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Extract latest observations at a given maximum delay — enw_obs_at_delay • epinowcast</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Extract latest observations at a given maximum delay — enw_obs_at_delay"><meta name="description" content="Filter observations to a maximum delay and then
extract the latest observations. This is useful for model
evaluation where you want to assess performance against the
data as the model would have seen it."><meta property="og:description" content="Filter observations to a maximum delay and then
extract the latest observations. This is useful for model
evaluation where you want to assess performance against the
data as the model would have seen it."><meta property="og:image" content="https://package.epinowcast.org/reference/figures/README-nowcast-1.png"><meta property="og:image:alt" content="An R package for flexible hierarchical nowcasting"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:creator" content="@seabbs"><meta name="twitter:site" content="@seabbs"><meta name="robots" content="noindex"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">epinowcast</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">0.5.0.1000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/epinowcast.html">Get started</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-reference" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Reference</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-reference"><li><a class="dropdown-item" href="../reference/index.html">R Reference</a></li>
    <li><a class="dropdown-item" href="https://package.epinowcast.org/stan/globals.html">Stan Reference</a></li>
  </ul></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><h6 class="dropdown-header" data-toc-skip>Model details</h6></li>
    <li><a class="dropdown-item" href="../articles/model.html">Model definition and implementation</a></li>
    <li><a class="dropdown-item" href="../articles/features.html">Model features summary</a></li>
    <li><a class="dropdown-item" href="../articles/distributions.html">Discretised distributions</a></li>
    <li><h6 class="dropdown-header" data-toc-skip>Case studies</h6></li>
    <li><a class="dropdown-item" href="../articles/germany-age-stratified-nowcasting.html">Hierarchical nowcasting of age stratified COVID-19 hospitalisations in Germany</a></li>
    <li><a class="dropdown-item" href="../articles/single-timeseries-rt-estimation.html">Estimating the effective reproduction number in real-time for a single timeseries with reporting delays</a></li>
    <li><h6 class="dropdown-header" data-toc-skip>Working with epinowcast</h6></li>
    <li><a class="dropdown-item" href="../articles/stan-help.html">Resources to help with model fitting using Stan</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/epinowcast/epinowcast/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Extract latest observations at a given maximum delay</h1>
      <small class="dont-index">Source: <a href="https://github.com/epinowcast/epinowcast/blob/main/R/preprocess.R" class="external-link"><code>R/preprocess.R</code></a></small>
      <div class="d-none name"><code>enw_obs_at_delay.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Filter observations to a maximum delay and then
extract the latest observations. This is useful for model
evaluation where you want to assess performance against the
data as the model would have seen it.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">enw_obs_at_delay</span><span class="op">(</span><span class="va">obs</span>, <span class="va">max_delay</span>, timestep <span class="op">=</span> <span class="st">"day"</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-obs">obs<a class="anchor" aria-label="anchor" href="#arg-obs"></a></dt>
<dd><p>A <code>data.frame</code> containing at least the following variables:
<code>reference date</code> (index date of interest), <code>report_date</code> (report date for
observations), and <code>confirm</code> (cumulative observations by reference and report
date).</p></dd>


<dt id="arg-max-delay">max_delay<a class="anchor" aria-label="anchor" href="#arg-max-delay"></a></dt>
<dd><p>The maximum delay to model in the delay
distribution, specified in units of the timestep (e.g., if
<code>timestep = "week"</code>, then <code>max_delay = 3</code> means 3 weeks). If not
specified the maximum observed delay is assumed to be the true maximum
delay in the model. Otherwise, an integer greater than or equal to 1
can be specified. Observations with delays larger than the maximum
delay will be dropped. If the specified maximum delay is too short,
nowcasts can be biased as important parts of the true delay
distribution are cut off. At the same time, computational cost scales
non-linearly with this setting, so you want the maximum delay to be
as long as necessary, but not much longer.</p>
<p>Steps to take to determine the maximum delay:</p><ul><li><p>Consider what is realistic and relevant for your application.</p></li>
<li><p>Check the proportion of observations reported (<code>prop_reported</code>)
by delay in the <code>new_confirm</code> output of <code>enw_preprocess_obs</code>.</p></li>
<li><p>Use <code><a href="check_max_delay.html">check_max_delay()</a></code> to check the coverage of a candidate
<code>max_delay</code>.</p></li>
<li><p>If in doubt, check if increasing the maximum delay noticeably
changes the delay distribution or nowcasts as estimated by
<code>epinowcast</code>. If it does, your maximum delay may still be too short.</p></li>
</ul><p>Note that delays are zero indexed and so include the reference date
and <code>max_delay - 1</code> other intervals (i.e. a <code>max_delay</code> of 1
corresponds to no delay).</p></dd>


<dt id="arg-timestep">timestep<a class="anchor" aria-label="anchor" href="#arg-timestep"></a></dt>
<dd><p>The timestep to used in the process model (i.e. the
reference date model). This can be a string ("day", "week", "month") or a
numeric whole number representing the number of days. If your data does not
have this timestep then you may wish to make use of
<code><a href="enw_aggregate_cumulative.html">enw_aggregate_cumulative()</a></code> to aggregate your data to the desired timestep.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A <code>data.table</code> of observations filtered for the
latest available data for each reference date at the
specified maximum delay.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>Preprocessing functions
<code><a href="enw_add_delay.html">enw_add_delay()</a></code>,
<code><a href="enw_add_max_reported.html">enw_add_max_reported()</a></code>,
<code><a href="enw_add_metaobs_features.html">enw_add_metaobs_features()</a></code>,
<code><a href="enw_assign_group.html">enw_assign_group()</a></code>,
<code><a href="enw_complete_dates.html">enw_complete_dates()</a></code>,
<code><a href="enw_construct_data.html">enw_construct_data()</a></code>,
<code><a href="enw_extend_date.html">enw_extend_date()</a></code>,
<code><a href="enw_filter_delay.html">enw_filter_delay()</a></code>,
<code><a href="enw_filter_reference_dates.html">enw_filter_reference_dates()</a></code>,
<code><a href="enw_filter_report_dates.html">enw_filter_report_dates()</a></code>,
<code><a href="enw_flag_observed_observations.html">enw_flag_observed_observations()</a></code>,
<code><a href="enw_impute_na_observations.html">enw_impute_na_observations()</a></code>,
<code><a href="enw_latest_data.html">enw_latest_data()</a></code>,
<code><a href="enw_metadata.html">enw_metadata()</a></code>,
<code><a href="enw_metadata_delay.html">enw_metadata_delay()</a></code>,
<code><a href="enw_missing_reference.html">enw_missing_reference()</a></code>,
<code><a href="enw_preprocess_data.html">enw_preprocess_data()</a></code>,
<code><a href="enw_reporting_triangle.html">enw_reporting_triangle()</a></code>,
<code><a href="enw_reporting_triangle_to_long.html">enw_reporting_triangle_to_long()</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">obs</span> <span class="op">&lt;-</span> <span class="fu"><a href="enw_example.html">enw_example</a></span><span class="op">(</span><span class="st">"preprocessed"</span><span class="op">)</span><span class="op">$</span><span class="va">obs</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="fu">enw_obs_at_delay</span><span class="op">(</span><span class="va">obs</span>, max_delay <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     reference_date .group report_date max_confirm location age_group confirm</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             &lt;IDat&gt;  &lt;num&gt;      &lt;IDat&gt;       &lt;int&gt;   &lt;fctr&gt;    &lt;fctr&gt;   &lt;int&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  1:     2021-07-14      1  2021-07-15          72       DE       00+      34</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  2:     2021-07-15      1  2021-07-16          69       DE       00+      43</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  3:     2021-07-16      1  2021-07-17          47       DE       00+      32</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  4:     2021-07-17      1  2021-07-18          65       DE       00+      27</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  5:     2021-07-18      1  2021-07-19          50       DE       00+      15</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  6:     2021-07-19      1  2021-07-20          36       DE       00+      19</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  7:     2021-07-20      1  2021-07-21          94       DE       00+      55</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  8:     2021-07-21      1  2021-07-22          91       DE       00+      46</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  9:     2021-07-22      1  2021-07-23          99       DE       00+      53</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10:     2021-07-23      1  2021-07-24          86       DE       00+      42</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11:     2021-07-24      1  2021-07-25          93       DE       00+      39</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 12:     2021-07-25      1  2021-07-26          74       DE       00+      12</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 13:     2021-07-26      1  2021-07-27          28       DE       00+      15</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 14:     2021-07-27      1  2021-07-28          78       DE       00+      46</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 15:     2021-07-28      1  2021-07-29         156       DE       00+      79</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 16:     2021-07-29      1  2021-07-30         135       DE       00+      84</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 17:     2021-07-30      1  2021-07-31         114       DE       00+      56</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 18:     2021-07-31      1  2021-08-01         126       DE       00+      54</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 19:     2021-08-01      1  2021-08-02          77       DE       00+      12</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 20:     2021-08-02      1  2021-08-03          59       DE       00+      26</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 21:     2021-08-03      1  2021-08-04         149       DE       00+      94</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 22:     2021-08-04      1  2021-08-05         166       DE       00+      94</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 23:     2021-08-05      1  2021-08-06         133       DE       00+      66</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 24:     2021-08-06      1  2021-08-07         137       DE       00+      78</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 25:     2021-08-07      1  2021-08-08         139       DE       00+      55</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 26:     2021-08-08      1  2021-08-09          97       DE       00+      27</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 27:     2021-08-09      1  2021-08-10          58       DE       00+      37</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 28:     2021-08-10      1  2021-08-11         175       DE       00+     121</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 29:     2021-08-11      1  2021-08-12         233       DE       00+     133</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 30:     2021-08-12      1  2021-08-13         237       DE       00+     137</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 31:     2021-08-13      1  2021-08-14         204       DE       00+     130</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 32:     2021-08-14      1  2021-08-15         189       DE       00+     115</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 33:     2021-08-15      1  2021-08-16         125       DE       00+      46</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 34:     2021-08-16      1  2021-08-17          98       DE       00+      55</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 35:     2021-08-17      1  2021-08-18         242       DE       00+     181</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 36:     2021-08-18      1  2021-08-19         223       DE       00+     178</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 37:     2021-08-19      1  2021-08-20         202       DE       00+     171</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 38:     2021-08-20      1  2021-08-21         171       DE       00+     159</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 39:     2021-08-21      1  2021-08-22         112       DE       00+     112</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 40:     2021-08-22      1  2021-08-22          45       DE       00+      45</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     reference_date .group report_date max_confirm location age_group confirm</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             &lt;IDat&gt;  &lt;num&gt;      &lt;IDat&gt;       &lt;int&gt;   &lt;fctr&gt;    &lt;fctr&gt;   &lt;int&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     cum_prop_reported delay</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 &lt;num&gt; &lt;num&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  1:         0.4722222     1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  2:         0.6231884     1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  3:         0.6808511     1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  4:         0.4153846     1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  5:         0.3000000     1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  6:         0.5277778     1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  7:         0.5851064     1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  8:         0.5054945     1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  9:         0.5353535     1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10:         0.4883721     1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11:         0.4193548     1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 12:         0.1621622     1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 13:         0.5357143     1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 14:         0.5897436     1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 15:         0.5064103     1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 16:         0.6222222     1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 17:         0.4912281     1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 18:         0.4285714     1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 19:         0.1558442     1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 20:         0.4406780     1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 21:         0.6308725     1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 22:         0.5662651     1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 23:         0.4962406     1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 24:         0.5693431     1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 25:         0.3956835     1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 26:         0.2783505     1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 27:         0.6379310     1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 28:         0.6914286     1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 29:         0.5708155     1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 30:         0.5780591     1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 31:         0.6372549     1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 32:         0.6084656     1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 33:         0.3680000     1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 34:         0.5612245     1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 35:         0.7479339     1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 36:         0.7982063     1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 37:         0.8465347     1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 38:         0.9298246     1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 39:         1.0000000     1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 40:         1.0000000     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     cum_prop_reported delay</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 &lt;num&gt; &lt;num&gt;</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://www.samabbott.co.uk/" class="external-link">Sam Abbott</a>, Adrian Lison, Sebastian Funk, Carl Pearson, Hugo Gruson, Felix Guenther, Michael DeWitt, James Mba Azam, Jessalyn Sebastian.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.9000.</p>
</div>

    </footer></div>





  </body></html>

