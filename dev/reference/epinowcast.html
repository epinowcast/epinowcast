<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Nowcast using partially observed data — epinowcast • epinowcast</title><!-- favicons --><link rel="icon" type="image/png" sizes="48x48" href="../favicon-48x48.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><script src="../deps/MathJax-3.2.2/tex-chtml.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Nowcast using partially observed data — epinowcast"><meta name="description" content="Provides a user friendly interface around package functionality
to produce a nowcast from observed preprocessed data, and a series of user
defined models. By default a model that assumes a fixed parametric reporting
distribution with a flexible expectation model is used. Explore the
individual model components for additional documentation and see the package
case studies for example model specifications for different tasks."><meta property="og:description" content="Provides a user friendly interface around package functionality
to produce a nowcast from observed preprocessed data, and a series of user
defined models. By default a model that assumes a fixed parametric reporting
distribution with a flexible expectation model is used. Explore the
individual model components for additional documentation and see the package
case studies for example model specifications for different tasks."><meta property="og:image" content="https://package.epinowcast.org/reference/figures/README-nowcast-1.png"><meta property="og:image:alt" content="An R package for flexible hierarchical nowcasting"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:creator" content="@seabbs"><meta name="twitter:site" content="@seabbs"><meta name="robots" content="noindex"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">epinowcast</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">0.3.0.1000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/epinowcast.html">Get started</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-reference" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Reference</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-reference"><li><a class="dropdown-item" href="../reference/index.html">R Reference</a></li>
    <li><a class="dropdown-item" href="https://package.epinowcast.org/stan/globals.html">Stan Reference</a></li>
  </ul></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><h6 class="dropdown-header" data-toc-skip>Model details</h6></li>
    <li><a class="dropdown-item" href="../articles/model.html">Model definition and implementation</a></li>
    <li><a class="dropdown-item" href="../articles/distributions.html">Discretised distributions</a></li>
    <li><h6 class="dropdown-header" data-toc-skip>Case studies</h6></li>
    <li><a class="dropdown-item" href="../articles/germany-age-stratified-nowcasting.html">Hierarchical nowcasting of age stratified COVID-19 hospitalisations in Germany</a></li>
    <li><a class="dropdown-item" href="../articles/single-timeseries-rt-estimation.html">Estimating the effective reproduction number in real-time for a single timeseries with reporting delays</a></li>
    <li><h6 class="dropdown-header" data-toc-skip>Working with epinowcast</h6></li>
    <li><a class="dropdown-item" href="../articles/stan-help.html">Resources to help with model fitting using Stan</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/epinowcast/epinowcast/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Nowcast using partially observed data</h1>
      <small class="dont-index">Source: <a href="https://github.com/epinowcast/epinowcast/blob/main/R/epinowcast.R" class="external-link"><code>R/epinowcast.R</code></a></small>
      <div class="d-none name"><code>epinowcast.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Provides a user friendly interface around package functionality
to produce a nowcast from observed preprocessed data, and a series of user
defined models. By default a model that assumes a fixed parametric reporting
distribution with a flexible expectation model is used. Explore the
individual model components for additional documentation and see the package
case studies for example model specifications for different tasks.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">epinowcast</span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  reference <span class="op">=</span> <span class="fu">epinowcast</span><span class="fu">::</span><span class="fu"><a href="enw_reference.html">enw_reference</a></span><span class="op">(</span>parametric <span class="op">=</span> <span class="op">~</span><span class="fl">1</span>, distribution <span class="op">=</span> <span class="st">"lognormal"</span>,</span>
<span>    non_parametric <span class="op">=</span> <span class="op">~</span><span class="fl">0</span>, data <span class="op">=</span> <span class="va">data</span><span class="op">)</span>,</span>
<span>  report <span class="op">=</span> <span class="fu">epinowcast</span><span class="fu">::</span><span class="fu"><a href="enw_report.html">enw_report</a></span><span class="op">(</span>non_parametric <span class="op">=</span> <span class="op">~</span><span class="fl">0</span>, structural <span class="op">=</span> <span class="op">~</span><span class="fl">0</span>, data <span class="op">=</span> <span class="va">data</span><span class="op">)</span>,</span>
<span>  expectation <span class="op">=</span> <span class="fu">epinowcast</span><span class="fu">::</span><span class="fu"><a href="enw_expectation.html">enw_expectation</a></span><span class="op">(</span>r <span class="op">=</span> <span class="op">~</span><span class="fl">0</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">day</span><span class="op">:</span><span class="va">.group</span><span class="op">)</span>, generation_time <span class="op">=</span></span>
<span>    <span class="fl">1</span>, observation <span class="op">=</span> <span class="op">~</span><span class="fl">1</span>, latent_reporting_delay <span class="op">=</span> <span class="fl">1</span>, data <span class="op">=</span> <span class="va">data</span><span class="op">)</span>,</span>
<span>  missing <span class="op">=</span> <span class="fu">epinowcast</span><span class="fu">::</span><span class="fu"><a href="enw_missing.html">enw_missing</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="op">~</span><span class="fl">0</span>, data <span class="op">=</span> <span class="va">data</span><span class="op">)</span>,</span>
<span>  obs <span class="op">=</span> <span class="fu">epinowcast</span><span class="fu">::</span><span class="fu"><a href="enw_obs.html">enw_obs</a></span><span class="op">(</span>family <span class="op">=</span> <span class="st">"negbin"</span>, data <span class="op">=</span> <span class="va">data</span><span class="op">)</span>,</span>
<span>  fit <span class="op">=</span> <span class="fu">epinowcast</span><span class="fu">::</span><span class="fu"><a href="enw_fit_opts.html">enw_fit_opts</a></span><span class="op">(</span>sampler <span class="op">=</span> <span class="fu">epinowcast</span><span class="fu">::</span><span class="va"><a href="enw_sample.html">enw_sample</a></span>, nowcast <span class="op">=</span> <span class="cn">TRUE</span>, pp <span class="op">=</span></span>
<span>    <span class="cn">FALSE</span>, likelihood <span class="op">=</span> <span class="cn">TRUE</span>, debug <span class="op">=</span> <span class="cn">FALSE</span>, output_loglik <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>  model <span class="op">=</span> <span class="fu">epinowcast</span><span class="fu">::</span><span class="fu"><a href="enw_model.html">enw_model</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  <span class="va">priors</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>Output from <code><a href="enw_preprocess_data.html">enw_preprocess_data()</a></code>.</p></dd>


<dt id="arg-reference">reference<a class="anchor" aria-label="anchor" href="#arg-reference"></a></dt>
<dd><p>The reference date indexed reporting process model
specification as defined using <code><a href="enw_reference.html">enw_reference()</a></code>.</p></dd>


<dt id="arg-report">report<a class="anchor" aria-label="anchor" href="#arg-report"></a></dt>
<dd><p>The report date indexed reporting process model
specification as defined using <code><a href="enw_report.html">enw_report()</a></code>.</p></dd>


<dt id="arg-expectation">expectation<a class="anchor" aria-label="anchor" href="#arg-expectation"></a></dt>
<dd><p>The expectation model specification as defined using
<code><a href="enw_expectation.html">enw_expectation()</a></code>. By default this is set to be a highly flexible random
effect by reference date for each group and thus weakly informed. Depending
on your context (and in particular the density of data reporting) other
choices that enforce more assumptions may be more appropriate (for example a
weekly random walk (specified using <code>rw(week, by = .group)</code>)).</p></dd>


<dt id="arg-missing">missing<a class="anchor" aria-label="anchor" href="#arg-missing"></a></dt>
<dd><p>The missing reference date model specification as defined
using <code><a href="enw_missing.html">enw_missing()</a></code>. By default this is set to not be used.</p></dd>


<dt id="arg-obs">obs<a class="anchor" aria-label="anchor" href="#arg-obs"></a></dt>
<dd><p>The observation model as defined by <code><a href="enw_obs.html">enw_obs()</a></code>.
Observations are also processed within this function for use in modelling.</p></dd>


<dt id="arg-fit">fit<a class="anchor" aria-label="anchor" href="#arg-fit"></a></dt>
<dd><p>Model fit options as defined using <code><a href="enw_fit_opts.html">enw_fit_opts()</a></code>. This includes
the sampler function to use (with the package default being <code><a href="enw_sample.html">enw_sample()</a></code>),
whether or now a nowcast should be used, etc. See <code><a href="enw_fit_opts.html">enw_fit_opts()</a></code> for
further details.</p></dd>


<dt id="arg-model">model<a class="anchor" aria-label="anchor" href="#arg-model"></a></dt>
<dd><p>The model to use within <code>fit</code>. By default this uses
<code><a href="enw_model.html">enw_model()</a></code>.</p></dd>


<dt id="arg-priors">priors<a class="anchor" aria-label="anchor" href="#arg-priors"></a></dt>
<dd><p>A <code>data.frame</code> with the following variables:
<code>variable</code>, <code>mean</code>, <code>sd</code> describing normal priors. Priors in the
appropriate format are returned by <code><a href="enw_reference.html">enw_reference()</a></code> as well as by
other similar model specification functions. Priors in this data.frame
replace the default priors specified by each model component.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Additional model modules to pass to <code>model</code>. User modules may
be used but currently require the supplied <code>model</code> to be adapted.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A object of the class "epinowcast" which inherits from
<code><a href="enw_preprocess_data.html">enw_preprocess_data()</a></code> and <code>data.table</code>, and combines the input data,
priors, and output from the sampler specified in <code><a href="enw_fit_opts.html">enw_fit_opts()</a></code>.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>Other epinowcast:
<code><a href="plot.epinowcast.html">plot.epinowcast</a>()</code>,
<code><a href="summary.epinowcast.html">summary.epinowcast</a>()</code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># interactive()</span></span></span>
<span class="r-in"><span><span class="co"># Load data.table and ggplot2</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Use 2 cores</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>mc.cores <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Load and filter germany hospitalisations</span></span></span>
<span class="r-in"><span><span class="va">nat_germany_hosp</span> <span class="op">&lt;-</span></span></span>
<span class="r-in"><span>  <span class="va">germany_covid19_hosp</span><span class="op">[</span><span class="va">location</span> <span class="op">==</span> <span class="st">"DE"</span><span class="op">]</span><span class="op">[</span><span class="va">age_group</span> <span class="op">==</span> <span class="st">"00+"</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">nat_germany_hosp</span> <span class="op">&lt;-</span> <span class="fu"><a href="enw_filter_report_dates.html">enw_filter_report_dates</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">nat_germany_hosp</span>,</span></span>
<span class="r-in"><span>  latest_date <span class="op">=</span> <span class="st">"2021-10-01"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Make sure observations are complete</span></span></span>
<span class="r-in"><span><span class="va">nat_germany_hosp</span> <span class="op">&lt;-</span> <span class="fu"><a href="enw_complete_dates.html">enw_complete_dates</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">nat_germany_hosp</span>,</span></span>
<span class="r-in"><span>  by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"location"</span>, <span class="st">"age_group"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Make a retrospective dataset</span></span></span>
<span class="r-in"><span><span class="va">retro_nat_germany</span> <span class="op">&lt;-</span> <span class="fu"><a href="enw_filter_report_dates.html">enw_filter_report_dates</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">nat_germany_hosp</span>,</span></span>
<span class="r-in"><span>  remove_days <span class="op">=</span> <span class="fl">40</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">retro_nat_germany</span> <span class="op">&lt;-</span> <span class="fu"><a href="enw_filter_reference_dates.html">enw_filter_reference_dates</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">retro_nat_germany</span>,</span></span>
<span class="r-in"><span>  include_days <span class="op">=</span> <span class="fl">40</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Get latest observations for the same time period</span></span></span>
<span class="r-in"><span><span class="va">latest_obs</span> <span class="op">&lt;-</span> <span class="fu"><a href="enw_latest_data.html">enw_latest_data</a></span><span class="op">(</span><span class="va">nat_germany_hosp</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">latest_obs</span> <span class="op">&lt;-</span> <span class="fu"><a href="enw_filter_reference_dates.html">enw_filter_reference_dates</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">latest_obs</span>,</span></span>
<span class="r-in"><span>  remove_days <span class="op">=</span> <span class="fl">40</span>, include_days <span class="op">=</span> <span class="fl">20</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Preprocess observations (note this maximum delay is likely too short)</span></span></span>
<span class="r-in"><span><span class="va">pobs</span> <span class="op">&lt;-</span> <span class="fu"><a href="enw_preprocess_data.html">enw_preprocess_data</a></span><span class="op">(</span><span class="va">retro_nat_germany</span>, max_delay <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Fit the default nowcast model and produce a nowcast</span></span></span>
<span class="r-in"><span><span class="co"># Note that we have reduced samples for this example to reduce runtimes</span></span></span>
<span class="r-in"><span><span class="va">nowcast</span> <span class="op">&lt;-</span> <span class="fu">epinowcast</span><span class="op">(</span><span class="va">pobs</span>,</span></span>
<span class="r-in"><span>  fit <span class="op">=</span> <span class="fu"><a href="enw_fit_opts.html">enw_fit_opts</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    save_warmup <span class="op">=</span> <span class="cn">FALSE</span>, pp <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>    chains <span class="op">=</span> <span class="fl">2</span>, iter_warmup <span class="op">=</span> <span class="fl">500</span>, iter_sampling <span class="op">=</span> <span class="fl">500</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">nowcast</span></span></span>
<span class="r-in"><span><span class="co"># plot the nowcast vs latest available observations</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">nowcast</span>, latest_obs <span class="op">=</span> <span class="va">latest_obs</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># plot posterior predictions for the delay distribution by date</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">nowcast</span>, type <span class="op">=</span> <span class="st">"posterior"</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">reference_date</span><span class="op">)</span>, scale <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://www.samabbott.co.uk/" class="external-link">Sam Abbott</a>, Adrian Lison, Sebastian Funk, Carl Pearson, Hugo Gruson, Felix Guenther, Michael DeWitt, James Mba Azam, Jessalyn Sebastian.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.9000.</p>
</div>

    </footer></div>





  </body></html>

