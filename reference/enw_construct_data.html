<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Construct preprocessed data — enw_construct_data • epinowcast</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Construct preprocessed data — enw_construct_data"><meta name="description" content="This function is used internally by enw_preprocess_data() to combine
various pieces of processed observed data into a single object. It
is exposed to the user in order to allow for modular data preprocessing
though this is not currently recommended. See documentation and code
of enw_preprocess_data() for more on the expected inputs."><meta property="og:description" content="This function is used internally by enw_preprocess_data() to combine
various pieces of processed observed data into a single object. It
is exposed to the user in order to allow for modular data preprocessing
though this is not currently recommended. See documentation and code
of enw_preprocess_data() for more on the expected inputs."><meta property="og:image" content="https://package.epinowcast.org/reference/figures/README-nowcast-1.png"><meta property="og:image:alt" content="An R package for flexible hierarchical nowcasting"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:creator" content="@seabbs"><meta name="twitter:site" content="@seabbs"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">epinowcast</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.4.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/epinowcast.html">Get started</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-reference" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Reference</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-reference"><li><a class="dropdown-item" href="../reference/index.html">R Reference</a></li>
    <li><a class="dropdown-item" href="https://package.epinowcast.org/stan/globals.html">Stan Reference</a></li>
  </ul></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><h6 class="dropdown-header" data-toc-skip>Model details</h6></li>
    <li><a class="dropdown-item" href="../articles/model.html">Model definition and implementation</a></li>
    <li><a class="dropdown-item" href="../articles/features.html">Model features summary</a></li>
    <li><a class="dropdown-item" href="../articles/distributions.html">Discretised distributions</a></li>
    <li><h6 class="dropdown-header" data-toc-skip>Case studies</h6></li>
    <li><a class="dropdown-item" href="../articles/germany-age-stratified-nowcasting.html">Hierarchical nowcasting of age stratified COVID-19 hospitalisations in Germany</a></li>
    <li><a class="dropdown-item" href="../articles/single-timeseries-rt-estimation.html">Estimating the effective reproduction number in real-time for a single timeseries with reporting delays</a></li>
    <li><h6 class="dropdown-header" data-toc-skip>Working with epinowcast</h6></li>
    <li><a class="dropdown-item" href="../articles/stan-help.html">Resources to help with model fitting using Stan</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/epinowcast/epinowcast/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Construct preprocessed data</h1>
      <small class="dont-index">Source: <a href="https://github.com/epinowcast/epinowcast/blob/v0.4.0/R/preprocess.R" class="external-link"><code>R/preprocess.R</code></a></small>
      <div class="d-none name"><code>enw_construct_data.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function is used internally by <code><a href="enw_preprocess_data.html">enw_preprocess_data()</a></code> to combine
various pieces of processed observed data into a single object. It
is exposed to the user in order to allow for modular data preprocessing
though this is not currently recommended. See documentation and code
of <code><a href="enw_preprocess_data.html">enw_preprocess_data()</a></code> for more on the expected inputs.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">enw_construct_data</span><span class="op">(</span></span>
<span>  <span class="va">obs</span>,</span>
<span>  <span class="va">new_confirm</span>,</span>
<span>  <span class="va">latest</span>,</span>
<span>  <span class="va">missing_reference</span>,</span>
<span>  <span class="va">reporting_triangle</span>,</span>
<span>  <span class="va">metareport</span>,</span>
<span>  <span class="va">metareference</span>,</span>
<span>  <span class="va">metadelay</span>,</span>
<span>  <span class="va">max_delay</span>,</span>
<span>  <span class="va">timestep</span>,</span>
<span>  <span class="va">by</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-obs">obs<a class="anchor" aria-label="anchor" href="#arg-obs"></a></dt>
<dd><p>Observations with the addition of empirical reporting proportions
and and restricted to the specified maximum delay.</p></dd>


<dt id="arg-new-confirm">new_confirm<a class="anchor" aria-label="anchor" href="#arg-new-confirm"></a></dt>
<dd><p>Incidence of notifications by reference and report date.
Empirical reporting distributions are also added.</p></dd>


<dt id="arg-latest">latest<a class="anchor" aria-label="anchor" href="#arg-latest"></a></dt>
<dd><p>The latest available observations.</p></dd>


<dt id="arg-missing-reference">missing_reference<a class="anchor" aria-label="anchor" href="#arg-missing-reference"></a></dt>
<dd><p>A <code>data.frame</code> of reported observations that are
missing the reference date.</p></dd>


<dt id="arg-reporting-triangle">reporting_triangle<a class="anchor" aria-label="anchor" href="#arg-reporting-triangle"></a></dt>
<dd><p>Incident observations by report and reference
date in the standard reporting triangle matrix format.</p></dd>


<dt id="arg-metareport">metareport<a class="anchor" aria-label="anchor" href="#arg-metareport"></a></dt>
<dd><p>Metadata for report dates.</p></dd>


<dt id="arg-metareference">metareference<a class="anchor" aria-label="anchor" href="#arg-metareference"></a></dt>
<dd><p>Metadata reference dates derived from observations.</p></dd>


<dt id="arg-metadelay">metadelay<a class="anchor" aria-label="anchor" href="#arg-metadelay"></a></dt>
<dd><p>Metadata for reporting delays produced using
<code><a href="enw_metadata_delay.html">enw_metadata_delay()</a></code>.</p></dd>


<dt id="arg-max-delay">max_delay<a class="anchor" aria-label="anchor" href="#arg-max-delay"></a></dt>
<dd><p>The maximum delay to model in the delay
distribution, specified in units of the timestep (e.g., if
<code>timestep = "week"</code>, then <code>max_delay = 3</code> means 3 weeks). If not
specified the maximum observed delay is assumed to be the true maximum
delay in the model. Otherwise, an integer greater than or equal to 1
can be specified. Observations with delays larger than the maximum
delay will be dropped. If the specified maximum delay is too short,
nowcasts can be biased as important parts of the true delay
distribution are cut off. At the same time, computational cost scales
non-linearly with this setting, so you want the maximum delay to be
as long as necessary, but not much longer.</p>
<p>Steps to take to determine the maximum delay:</p><ul><li><p>Consider what is realistic and relevant for your application.</p></li>
<li><p>Check the proportion of observations reported (<code>prop_reported</code>)
by delay in the <code>new_confirm</code> output of <code>enw_preprocess_obs</code>.</p></li>
<li><p>Use <code><a href="check_max_delay.html">check_max_delay()</a></code> to check the coverage of a candidate
<code>max_delay</code>.</p></li>
<li><p>If in doubt, check if increasing the maximum delay noticeably
changes the delay distribution or nowcasts as estimated by
<code>epinowcast</code>. If it does, your maximum delay may still be too short.</p></li>
</ul><p>Note that delays are zero indexed and so include the reference date
and <code>max_delay - 1</code> other intervals (i.e. a <code>max_delay</code> of 1
corresponds to no delay).</p></dd>


<dt id="arg-timestep">timestep<a class="anchor" aria-label="anchor" href="#arg-timestep"></a></dt>
<dd><p>The timestep to used in the process model (i.e. the
reference date model). This can be a string ("day", "week", "month") or a
numeric whole number representing the number of days. If your data does not
have this timestep then you may wish to make use of
<code><a href="enw_aggregate_cumulative.html">enw_aggregate_cumulative()</a></code> to aggregate your data to the desired timestep.</p></dd>


<dt id="arg-by">by<a class="anchor" aria-label="anchor" href="#arg-by"></a></dt>
<dd><p>A character vector describing the stratification of
observations. This defaults to no grouping. This should be used
when modelling multiple time series in order to identify them for
downstream modelling</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A data.table containing processed observations as a series of nested
data.frames as well as variables containing metadata. These are:</p><ul><li><p><code>obs</code>: (observations with the addition of empirical reporting proportions
and restricted to the specified maximum delay).</p></li>
<li><p><code>new_confirm</code>: Incidence of notifications by reference and report date.
Empirical reporting distributions are also added.</p></li>
<li><p><code>latest</code>: The latest available observations.</p></li>
<li><p><code>missing_reference</code>: Observations missing reference dates.</p></li>
<li><p><code>reporting_triangle</code>: Incident observations by report and reference date in
the standard reporting triangle matrix format.</p></li>
<li><p><code>metareference</code>: Metadata reference dates derived from observations.</p></li>
<li><p><code>metrareport</code>: Metadata for report dates.</p></li>
<li><p><code>metadelay</code>: Metadata for reporting delays produced using
<code><a href="enw_metadata_delay.html">enw_metadata_delay()</a></code>.</p></li>
<li><p><code>max_delay</code>: Maximum delay to be modelled by epinowcast.</p></li>
<li><p><code>time</code>: Numeric, number of timepoints in the data.</p></li>
<li><p><code>snapshots</code>: Numeric, number of available data snapshots to use for
nowcasting.</p></li>
<li><p><code>groups</code>: Numeric, Number of groups/strata in the supplied observations
(set using <code>by</code>).</p></li>
<li><p><code>max_date</code>: The maximum available report date.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>Preprocessing functions
<code><a href="enw_add_delay.html">enw_add_delay</a>()</code>,
<code><a href="enw_add_max_reported.html">enw_add_max_reported</a>()</code>,
<code><a href="enw_add_metaobs_features.html">enw_add_metaobs_features</a>()</code>,
<code><a href="enw_assign_group.html">enw_assign_group</a>()</code>,
<code><a href="enw_complete_dates.html">enw_complete_dates</a>()</code>,
<code><a href="enw_extend_date.html">enw_extend_date</a>()</code>,
<code><a href="enw_filter_delay.html">enw_filter_delay</a>()</code>,
<code><a href="enw_filter_reference_dates.html">enw_filter_reference_dates</a>()</code>,
<code><a href="enw_filter_report_dates.html">enw_filter_report_dates</a>()</code>,
<code><a href="enw_flag_observed_observations.html">enw_flag_observed_observations</a>()</code>,
<code><a href="enw_impute_na_observations.html">enw_impute_na_observations</a>()</code>,
<code><a href="enw_latest_data.html">enw_latest_data</a>()</code>,
<code><a href="enw_metadata.html">enw_metadata</a>()</code>,
<code><a href="enw_metadata_delay.html">enw_metadata_delay</a>()</code>,
<code><a href="enw_missing_reference.html">enw_missing_reference</a>()</code>,
<code><a href="enw_preprocess_data.html">enw_preprocess_data</a>()</code>,
<code><a href="enw_reporting_triangle.html">enw_reporting_triangle</a>()</code>,
<code><a href="enw_reporting_triangle_to_long.html">enw_reporting_triangle_to_long</a>()</code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">pobs</span> <span class="op">&lt;-</span> <span class="fu"><a href="enw_example.html">enw_example</a></span><span class="op">(</span><span class="st">"preprocessed"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">enw_construct_data</span><span class="op">(</span></span></span>
<span class="r-in"><span>  obs <span class="op">=</span> <span class="va">pobs</span><span class="op">$</span><span class="va">obs</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>  new_confirm <span class="op">=</span> <span class="va">pobs</span><span class="op">$</span><span class="va">new_confirm</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>  latest <span class="op">=</span> <span class="va">pobs</span><span class="op">$</span><span class="va">latest</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>  missing_reference <span class="op">=</span> <span class="va">pobs</span><span class="op">$</span><span class="va">missing_reference</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>  reporting_triangle <span class="op">=</span> <span class="va">pobs</span><span class="op">$</span><span class="va">reporting_triangle</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>  metareport <span class="op">=</span> <span class="va">pobs</span><span class="op">$</span><span class="va">metareport</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>  metareference <span class="op">=</span> <span class="va">pobs</span><span class="op">$</span><span class="va">metareference</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>  metadelay <span class="op">=</span> <span class="va">pobs</span><span class="op">$</span><span class="va">metadelay</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>  max_delay <span class="op">=</span> <span class="va">pobs</span><span class="op">$</span><span class="va">max_delay</span>,</span></span>
<span class="r-in"><span>  timestep <span class="op">=</span> <span class="va">pobs</span><span class="op">$</span><span class="va">timestep</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>  by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                    obs          new_confirm              latest</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 &lt;list&gt;               &lt;list&gt;              &lt;list&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1: &lt;data.table[650x9]&gt; &lt;data.table[610x11]&gt; &lt;data.table[40x10]&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     missing_reference  reporting_triangle      metareference</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                &lt;list&gt;              &lt;list&gt;             &lt;list&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1: &lt;data.table[40x6]&gt; &lt;data.table[40x22]&gt; &lt;data.table[40x9]&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             metareport          metadelay max_delay  time snapshots     by</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 &lt;list&gt;             &lt;list&gt;     &lt;num&gt; &lt;int&gt;     &lt;int&gt; &lt;list&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1: &lt;data.table[59x12]&gt; &lt;data.table[20x5]&gt;        20    40        40 [NULL]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    groups   max_date timestep</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     &lt;int&gt;     &lt;IDat&gt;   &lt;char&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1:      1 2021-08-22      day</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://www.samabbott.co.uk/" class="external-link">Sam Abbott</a>, Adrian Lison, Sebastian Funk, Carl Pearson, Hugo Gruson, Felix Guenther, Michael DeWitt, James Mba Azam, Jessalyn Sebastian.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.9000.</p>
</div>

    </footer></div>





  </body></html>

